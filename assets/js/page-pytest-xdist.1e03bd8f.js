(window.webpackJsonp=window.webpackJsonp||[]).push([[188],{1247:function(t,s,a){"use strict";a.r(s);var n=a(1),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"pytest-xdist"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pytest-xdist"}},[t._v("#")]),t._v(" pytest-xdist")]),t._v(" "),n("h2",{attrs:{id:"什么是-pytest-xdist"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#什么是-pytest-xdist"}},[t._v("#")]),t._v(" 什么是 pytest-xdist")]),t._v(" "),n("ul",[n("li",[t._v("Pytest 的一款插件")]),t._v(" "),n("li",[t._v("可以分布式执行测试用例")])]),t._v(" "),n("h2",{attrs:{id:"为什么要用-pytest-xdist"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#为什么要用-pytest-xdist"}},[t._v("#")]),t._v(" 为什么要用 pytest-xdist")]),t._v(" "),n("ul",[n("li",[t._v("平常我们功能测试用例非常多时，比如有 1 千条用例，假设每个用例执行需要 1分钟，如果单个测试人员执行需要 1000 分钟才能跑完")]),t._v(" "),n("li",[t._v("当项目非常紧急时，会需要协调多个测试资源来把任务分成两部分，于是执行时间缩短一半，如果有 10 个小伙伴，那么执行时间就会变成十分之一，大大节省了测试时间")]),t._v(" "),n("li",[t._v("为了节省项目测试时间，10 个测试同时并行测试，这就是一种分布式场景")]),t._v(" "),n("li",[t._v("同样道理，当我们自动化测试用例非常多的时候，一条条按顺序执行会非常慢，"),n("code",[t._v("pytest-xdist")]),t._v(" 的出现就是为了让自动化测试用例可以分布式执行，从而节省自动化测试时间")]),t._v(" "),n("li",[n("code",[t._v("pytest-xdist")]),t._v(" 是属于进程级别的并发")])]),t._v(" "),n("h2",{attrs:{id:"安装-pytest-xdist"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装-pytest-xdist"}},[t._v("#")]),t._v(" 安装 pytest-xdist")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("pip install pytest"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("xdist\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("pytest-xdist 通过一些独特的测试执行模式扩展了 Pytest:")]),t._v(" "),n("ul",[n("li",[t._v("测试运行并行化：如果有多个 CPU 或主机，则可以将它们用于组合的测试运行，这样可以加快开发速度或使用远程计算机的特殊资源")]),t._v(" "),n("li",[n("code",[t._v("--looponfail")]),t._v("：在子进程中重复运行测试，每次运行之后，Pytest 都会等到项目中的文件更改后再运行之前失败的测试，重复此过程，直到所有测试通过，然后再次执行完整运行")]),t._v(" "),n("li",[t._v("跨平台覆盖：您可以指定不同的 Python 解释程序或不同的平台，并在所有这些平台上并行运行测试")])])]),t._v(" "),n("h3",{attrs:{id:"执行命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#执行命令"}},[t._v("#")]),t._v(" 执行命令")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("pytest "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" \n或\npytest "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("n auto\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("p",[n("strong",[n("code",[t._v("-n 3")])]),t._v(": 指定具体的进程数")]),t._v(" "),n("p",[n("strong",[n("code",[t._v("-n auto")])]),t._v(": 使用与计算机 CPU 内核一样多的进程")]),t._v(" "),n("h2",{attrs:{id:"pytest-xdist-示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pytest-xdist-示例"}},[t._v("#")]),t._v(" pytest-xdist 示例")]),t._v(" "),n("h3",{attrs:{id:"项目工程结构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#项目工程结构"}},[t._v("#")]),t._v(" 项目工程结构")]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("web_conf是工程名称\n├─douban\n│  │  conftest.py\n│  │  test_douban.py\n│  │  __init__.py\n|\n├─jd\n│  │  test_jd.py\n│        \n├─taobao\n│  │  conftest.py\n│  │  test_taobao.py\n│  │  __init__.py\n│   \n|  main.py\n│  conftest.py\n│  __init__.py\n|  test_001.py\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br")])]),n("h3",{attrs:{id:"web-conf-下"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#web-conf-下"}},[t._v("#")]),t._v(" web_conf 下")]),t._v(" "),n("h4",{attrs:{id:"conftest-py-代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#conftest-py-代码"}},[t._v("#")]),t._v(" conftest.py 代码")]),t._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("点击查看代码")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" pytest\n"),n("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@pytest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fixture")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("scope"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"session"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("start")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n获取driver，全局获取一次"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    driver "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Chrom"')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v(" driver\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n释放driver，全局释放一次"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@pytest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fixture")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("autouse"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get_driver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n每个用例都要获取driver"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" start\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br")])])]),t._v(" "),n("h4",{attrs:{id:"main-py-代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#main-py-代码"}},[t._v("#")]),t._v(" main.py 代码")]),t._v(" "),n("p",[t._v("运行所有用例")]),t._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("点击查看代码")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" pytest\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" __name__ "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'__main__'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    pytest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("main"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"-s"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])])]),t._v(" "),n("h4",{attrs:{id:"test-001-py-代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#test-001-py-代码"}},[t._v("#")]),t._v(" test_001.py 代码")]),t._v(" "),n("p",[t._v("根目录下的测试用例")]),t._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("点击查看代码")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" time "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" sleep\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("test_001")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string-interpolation"}},[n("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"\\n测试用例1获取driver:')]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br")])])]),t._v(" "),n("h3",{attrs:{id:"web-conf-douban-下"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#web-conf-douban-下"}},[t._v("#")]),t._v(" web_conf/douban 下")]),t._v(" "),n("h4",{attrs:{id:"conftest-py-代码-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#conftest-py-代码-2"}},[t._v("#")]),t._v(" conftest.py 代码")]),t._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("点击查看代码")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" pytest\n"),n("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@pytest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fixture")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("scope"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"module"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("open_douban")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n打开douban页面"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" start\n\n"),n("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@pytest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fixture")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("login")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("open_douban"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n登录成功"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    token "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"douban"')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v(" token\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n退出登录"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br")])])]),t._v(" "),n("h4",{attrs:{id:"test-douban-py-代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#test-douban-py-代码"}},[t._v("#")]),t._v(" test_douban.py 代码")]),t._v(" "),n("p",[t._v("douban 包下的测试用例")]),t._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("点击查看代码")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" pytest\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" time "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" sleep\n\n"),n("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@pytest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mark"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("repeat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("test_002")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("login"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string-interpolation"}},[n("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"\\n')]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("login"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v(' 操作douban111"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@pytest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mark"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("repeat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("test_003")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("login"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string-interpolation"}},[n("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"\\n')]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("login"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v(' 操作douban222"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br")])])]),t._v(" "),n("h3",{attrs:{id:"web-conf-jd-下"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#web-conf-jd-下"}},[t._v("#")]),t._v(" web_conf/jd 下")]),t._v(" "),n("p",[t._v("目录下没有 "),n("code",[t._v("__init__.py")]),t._v(" 文件")]),t._v(" "),n("h4",{attrs:{id:"test-jdn-py-代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#test-jdn-py-代码"}},[t._v("#")]),t._v(" test_jdn.py 代码")]),t._v(" "),n("p",[t._v("jd 包下的测试用例")]),t._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("点击查看代码")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" pytest\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" time "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" sleep\n\n"),n("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@pytest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mark"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("repeat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("test_jd1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string-interpolation"}},[n("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"\\n')]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v(' 操作jd1"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@pytest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mark"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("repeat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("test_jd2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string-interpolation"}},[n("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"\\n')]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v(' 操作jd2"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br")])])]),t._v(" "),n("h3",{attrs:{id:"web-conf-taobao-下"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#web-conf-taobao-下"}},[t._v("#")]),t._v(" web_conf/taobao 下")]),t._v(" "),n("h4",{attrs:{id:"conftest-py-代码-3"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#conftest-py-代码-3"}},[t._v("#")]),t._v(" conftest.py 代码")]),t._v(" "),n("p",[t._v("设置 taobao 包下的 fixture")]),t._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("点击查看代码")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" pytest\n\n"),n("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@pytest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fixture")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("scope"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"module"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("open_taobao")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("start"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n打开taobao页面"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" start\n\n"),n("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@pytest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fixture")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("login")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("open_taobao"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n登录成功"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    token "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"taobao"')]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v(" token\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\n退出登录"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br")])])]),t._v(" "),n("h4",{attrs:{id:"test-taobao-py-代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#test-taobao-py-代码"}},[t._v("#")]),t._v(" "),n("code",[t._v("test_taobao.py")]),t._v(" 代码")]),t._v(" "),n("p",[t._v("taobao 包下的测试用例")]),t._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("点击查看代码")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" pytest\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" time "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" sleep\n\n"),n("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@pytest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mark"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("repeat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("test_taobao1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("login"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string-interpolation"}},[n("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"\\n')]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("login"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v(' 操作taobao1"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@pytest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mark"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("repeat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("test_taobao2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("login"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    sleep"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string-interpolation"}},[n("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"\\n')]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("login"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v(' 操作taobao2"')])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br")])])]),t._v(" "),n("p",[n("strong",[t._v("不使用分布式测试和执行结果")]),t._v("：")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("pytest "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#结果：")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("31")]),t._v(" passed "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("31")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("40s\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br")])]),n("p",[t._v("上面每条用例执行之前都加了等待时间 1 s，总共 31 条用例，时间为 31 秒")]),t._v(" "),n("p",[n("strong",[t._v("使用分布式测试和执行结果")]),t._v("：\n指定进程数 5：")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("pytest "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("s "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("n "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("p",[t._v("结果：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(712),alt:"pytest"}})]),t._v(" "),n("p",[t._v("结果明显比不使用分布式时缩短了很多")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("pytest-xdist 可以和 pytest-html 结合使用")]),t._v(" "),n("p",[t._v("pytest -s -n auto --html=report.html --self-contained-html")])]),t._v(" "),n("h2",{attrs:{id:"分布式执行用例设计原则-重点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#分布式执行用例设计原则-重点"}},[t._v("#")]),t._v(" 分布式执行用例设计原则(重点)")]),t._v(" "),n("ul",[n("li",[t._v("用例之间是独立的，用例之间没有依赖关系，用例可以完全独立运行")]),t._v(" "),n("li",[t._v("用例执行没有顺序，随机顺序都能正常执行")]),t._v(" "),n("li",[t._v("每个用例都能重复运行，运行结果不会影响其他用例")])]),t._v(" "),n("h2",{attrs:{id:"pytest-xdist-执行顺序"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pytest-xdist-执行顺序"}},[t._v("#")]),t._v(" pytest-xdist 执行顺序")]),t._v(" "),n("p",[t._v("pytest-xdist 默认是无序执行的，可以通过 "),n("code",[t._v("--dist")]),t._v(" 参数来控制顺序")]),t._v(" "),n("p",[n("code",[t._v("test_xdist1.py")])]),t._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("点击查看代码")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("test1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'执行用例111'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Test1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("test12")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'执行用例121212'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("test13")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'执行用例131313'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br")])])]),t._v(" "),n("p",[t._v("test_xdist2.py")]),t._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("点击查看代码")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("test2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'执行用例2222'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Test2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("test22")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'执行用例22222'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("test23")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'执行用例232323'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br")])])]),t._v(" "),n("h3",{attrs:{id:"dist-load"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dist-load"}},[t._v("#")]),t._v(" "),n("code",[t._v("--dist=load")])]),t._v(" "),n("p",[t._v("将待运行的用例随机发给可用的执行器 worker，用例执行顺序随机的，目前默认采用这种方式")]),t._v(" "),n("p",[t._v("执行命令："),n("code",[t._v("pytest -s -v -n 3 --dist=load test_xdist1.py")])]),t._v(" "),n("p",[t._v("执行结果：")]),t._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("点击查看结果")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("test_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test13\ntest_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test1\ntest_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test12\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gw2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" PASSED test_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test13\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gw0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" PASSED test_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test1\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gw1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" PASSED test_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test12\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br")])])]),t._v(" "),n("p",[t._v("[gw0] 、[gw1] 、[gw2] 随机执行用例")]),t._v(" "),n("h3",{attrs:{id:"dist-loadscope"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dist-loadscope"}},[t._v("#")]),t._v(" "),n("code",[t._v("--dist=loadscope")])]),t._v(" "),n("ul",[n("li",[t._v("将按照同一个模块 module 下的函数和同一个测试类 class 下的方法来分组，然后将每个测试组发给可以执行的 worker，确保同一个组的测试用例在同一个进程中执行")]),t._v(" "),n("li",[t._v("目前无法自定义分组，按类 class 分组优先于按模块 module 分组")])]),t._v(" "),n("p",[t._v("执行命令："),n("code",[t._v("pytest -s -v -n 3 --dist=loadscope test_xdist1.py test_xdist2.py")])]),t._v(" "),n("p",[t._v("执行结果：")]),t._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("点击查看结果")]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("结果：\ntest_xdist2.py::test2\ntest_xdist1.py::Test1::test12\ntest_xdist1.py::test1\n[gw2] PASSED test_xdist2.py::test2\n[gw0] PASSED test_xdist1.py::test1\n[gw1] PASSED test_xdist1.py::Test1::test12\ntest_xdist1.py::Test1::test13\ntest_xdist2.py::Test2::test22\n[gw1] PASSED test_xdist1.py::Test1::test13\n[gw0] PASSED test_xdist2.py::Test2::test22\ntest_xdist2.py::Test2::test23\n[gw0] PASSED test_xdist2.py::Test2::test23\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br")])])]),t._v(" "),n("p",[t._v("[gw0]: 执行 "),n("code",[t._v("test_xdist1.py::test1、test_xdist2.py::Test2::test22")]),t._v("、"),n("code",[t._v("test_xdist2.py::Test2::test23")]),t._v(" 用例")]),t._v(" "),n("p",[t._v("[gw1]: 执行 "),n("code",[t._v("test_xdist1.py::Test1::test12")]),t._v("、"),n("code",[t._v("test_xdist1.py::Test1::test13")]),t._v(" 用例")]),t._v(" "),n("p",[t._v("[gw2]: 执行 "),n("code",[t._v("test_xdist2.py::test2")]),t._v(" 用例")]),t._v(" "),n("h3",{attrs:{id:"dist-loadfile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dist-loadfile"}},[t._v("#")]),t._v(" "),n("code",[t._v("--dist=loadfile")])]),t._v(" "),n("p",[t._v("按照同一个文件名来分组，然后将每个测试组发给可以执行的 worker，确保同一个组的测试用例在同一个进程中执行")]),t._v(" "),n("p",[t._v("执行命令："),n("code",[t._v("pytest -s -v -n 3 --dist=loadfile test_xdist1.py test_xdist2.py")])]),t._v(" "),n("p",[t._v("执行结果：")]),t._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("点击查看结果")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("test_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test1\ntest_xdist2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test2\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gw1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" PASSED test_xdist2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test2\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gw0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" PASSED test_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test1\ntest_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test12\ntest_xdist2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test22\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gw0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" PASSED test_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test12\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gw1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" PASSED test_xdist2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test22\ntest_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test13\ntest_xdist2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test23\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gw0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" PASSED test_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test13\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gw1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" PASSED test_xdist2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test23\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br")])])]),t._v(" "),n("p",[t._v("[gw0]: 执行 "),n("code",[t._v("test_xdist1.py")]),t._v(" 下的所有用例")]),t._v(" "),n("p",[t._v("[gw1]: 执行 "),n("code",[t._v("test_xdist2.py")]),t._v(" 下的所有用例")]),t._v(" "),n("h3",{attrs:{id:"dist-each"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#dist-each"}},[t._v("#")]),t._v(" "),n("code",[t._v("--dist=each")])]),t._v(" "),n("p",[t._v("是将每个用例，分别发给所有的执行器 worker，相当于开了几个执行器 worker，同一个用例就执行几遍")]),t._v(" "),n("p",[t._v("执行命令："),n("code",[t._v("pytest -s -v -n 3 --dist=each test_xdist1.py")])]),t._v(" "),n("p",[t._v("执行结果：")]),t._v(" "),n("details",{staticClass:"custom-block details"},[n("summary",[t._v("点击查看结果")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[t._v("test_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test1\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gw2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" PASSED test_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test1\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gw1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" PASSED test_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test1\ntest_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test12\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gw0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" PASSED test_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test1\ntest_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test12\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gw2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" PASSED test_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test12\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gw0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" PASSED test_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test12\ntest_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test12\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gw1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" PASSED test_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test12\ntest_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test13\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gw2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" PASSED test_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test13\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gw0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" PASSED test_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test13\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("gw1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" PASSED test_xdist1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("Test1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("test13\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br")])])]),t._v(" "),n("p",[t._v("可以看到，每个用例都分别被 [gw0]、[gw1]、[gw2] 执行了一遍")]),t._v(" "),n("h2",{attrs:{id:"如何让-scope-session-的-fixture-在-test-session-中仅仅执行一次"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何让-scope-session-的-fixture-在-test-session-中仅仅执行一次"}},[t._v("#")]),t._v(" 如何让 "),n("code",[t._v("scope=session")]),t._v(" 的 fixture 在 test session 中仅仅执行一次")]),t._v(" "),n("h3",{attrs:{id:"存在问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#存在问题"}},[t._v("#")]),t._v(" 存在问题")]),t._v(" "),n("p",[t._v("pytest-xdist 是让每个 worker 进程执行属于自己的测试用例集下的所有测试用例")]),t._v(" "),n("p",[t._v("这意味着在不同进程中，不同的测试用例可能会调用同一个 scope 范围级别较高（例如 session）的 fixture，该 fixture 则会被执行多次，这不符合 "),n("code",[t._v("scope=session")]),t._v(" 的预期")]),t._v(" "),n("h3",{attrs:{id:"如何解决"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何解决"}},[t._v("#")]),t._v(" 如何解决")]),t._v(" "),n("p",[n("code",[t._v("pytest-xdist")]),t._v(" 没有内置的支持来确保会话范围的夹具仅执行一次，但是可以通过使用锁定文件进行进程间通信来实现")]),t._v(" "),n("p",[t._v("例子：")]),t._v(" "),n("div",{staticClass:"language-python line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-python"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" pytest\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" filelock "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" FileLock\n\n"),n("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@pytest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fixture")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("scope"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"session"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("login")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"====登录功能，返回账号，token==="')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" FileLock"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"session.lock"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"testyy"')]),t._v("\n        token "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"npoi213bn4"')]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# web ui自动化")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 声明一个driver，再返回")]),t._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 接口自动化")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 发起一个登录请求，将token返回都可以这样写")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("yield")]),t._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" token\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"====退出登录！！！===="')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br")])]),n("ul",[n("li",[t._v("下面的示例只需要执行一次 login（因为它是只需要执行一次来定义配置选项，等等）")]),t._v(" "),n("li",[t._v("当第一次请求这个 fixture 时，则会利用 FileLock 仅产生一次 fixture 数据")]),t._v(" "),n("li",[t._v("当其他进程再次请求这个 fixture 时，则会从文件中读取数据")])]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("思考")]),t._v(" "),n("ul",[n("li",[t._v("对于用例中有阻断进程的操作，如 sleep 操作，"),n("code",[t._v("pytest-xdist")]),t._v(" 分布式执行确实效果很显著")]),t._v(" "),n("li",[t._v("对于 "),n("code",[t._v("pytest-xdist")]),t._v(" 有没有用例量级的限制？如果超过这个量级，"),n("code",[t._v("pytest-xdist")]),t._v(" 分布式是否还有效果？这个暂时还没有得到这个量化")]),t._v(" "),n("li",[t._v("如果用例中使用了多线程，那 "),n("code",[t._v("pytest-xdist")]),t._v(" 的方式还有效？这个待后续研究")])])]),t._v(" "),n("h2",{attrs:{id:"参考资料"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://pytest-xdist.readthedocs.io/en/latest/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档-pytest-xdist"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("a",{attrs:{href:"https://www.jianshu.com/p/1c3c3095d2a9",target:"_blank",rel:"noopener noreferrer"}},[t._v("Pytest 分布式执行 pytest-xdist"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("（完）")])])}),[],!1,null,null,null);s.default=e.exports},712:function(t,s,a){t.exports=a.p+"assets/img/37.e764c3ef.png"}}]);