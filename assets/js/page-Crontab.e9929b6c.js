(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{1051:function(a,t,s){"use strict";s.r(t);var r=s(1),v=Object(r.a)({},(function(){var a=this,t=a.$createElement,r=a._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[r("h1",{attrs:{id:"crontab"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#crontab"}},[a._v("#")]),a._v(" Crontab")]),a._v(" "),r("h2",{attrs:{id:"简介"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[a._v("#")]),a._v(" 简介")]),a._v(" "),r("p",[a._v("作用：用于设置周期性被执行的指令")]),a._v(" "),r("p",[a._v("定时任务包含：")]),a._v(" "),r("ul",[r("li",[a._v("cron：服务名称")]),a._v(" "),r("li",[a._v("crond：后台进程")]),a._v(" "),r("li",[a._v("crontab：计划任务表")])]),a._v(" "),r("h2",{attrs:{id:"任务分类"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#任务分类"}},[a._v("#")]),a._v(" 任务分类")]),a._v(" "),r("h3",{attrs:{id:"系统任务调度"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#系统任务调度"}},[a._v("#")]),a._v(" 系统任务调度")]),a._v(" "),r("p",[a._v("系统周期性所要执行的工作")]),a._v(" "),r("p",[a._v("在 /etc 目录下有一个 crontab 文件，如下：")]),a._v(" "),r("p",[r("img",{attrs:{src:s(533),alt:"crontab"}})]),a._v(" "),r("p",[a._v("前四行用来配置 crontab 任务运行的环境变量：")]),a._v(" "),r("ul",[r("li",[r("p",[a._v("SHELL")]),a._v(" "),r("p",[a._v("指定了系统要使用哪个 shell")])]),a._v(" "),r("li",[r("p",[a._v("PATH")]),a._v(" "),r("p",[a._v("指定了系统执行命令的路径")])]),a._v(" "),r("li",[r("p",[a._v("MAILTO")]),a._v(" "),r("p",[a._v("指定了crond 的任务执行信息将通过电子邮件发送给 root 用户，如果 MAILTO 变量的值为空，则表示不发送任务执行信息给用户")])]),a._v(" "),r("li",[r("p",[a._v("HOME")]),a._v(" "),r("p",[a._v("指定了在执行命令或者脚本时使用的主目录")])])]),a._v(" "),r("h3",{attrs:{id:"用户任务调度"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#用户任务调度"}},[a._v("#")]),a._v(" 用户任务调度")]),a._v(" "),r("p",[a._v("用户定期要执行的工作")]),a._v(" "),r("p",[a._v("使用 crontab 来定制自己的计划任务")]),a._v(" "),r("p",[a._v("所有用户定义的 crontab 文件都被保存在 "),r("code",[a._v("/var/spool/cron")]),a._v(" 目录下")]),a._v(" "),r("h2",{attrs:{id:"crontab-命令"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#crontab-命令"}},[a._v("#")]),a._v(" Crontab 命令")]),a._v(" "),r("ul",[r("li",[r("p",[a._v("crontab [-u user] file")]),a._v(" "),r("p",[a._v("将 file 做为 crontab 的任务列表文件并载入 crontab")]),a._v(" "),r("p",[a._v("如果没有指定这个文件，crontab 命令将接受标准输入（键盘）上键入的命令，并将它们载入crontab")])]),a._v(" "),r("li",[r("p",[a._v("crontab [-u user] -e")]),a._v(" "),r("p",[a._v("编辑某个用户的 crontab 文件内容")]),a._v(" "),r("p",[a._v("如果不指定用户，则表示编辑当前用户的 crontab 文件内容。")])]),a._v(" "),r("li",[r("p",[a._v("crontab [-u user] -l")]),a._v(" "),r("p",[a._v("显示某个用户的 crontab 文件内容")]),a._v(" "),r("p",[a._v("如果不指定用户，则表示显示当前用户的c rontab 文件内容。")])]),a._v(" "),r("li",[r("p",[a._v("crontab [-u user] -[i]r")]),a._v(" "),r("p",[a._v("从 "),r("code",[a._v("/var/spool/cron")]),a._v(" 目录中删除某个用户的 crontab 文件")]),a._v(" "),r("p",[a._v("如果不指定用户，则默认删除当前用户的 crontab 文件")]),a._v(" "),r("p",[a._v("-i 参数指定在删除用户的 crontab 文件时是否给确认提示")])])]),a._v(" "),r("h2",{attrs:{id:"crontab-内容格式"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#crontab-内容格式"}},[a._v("#")]),a._v(" Crontab 内容格式")]),a._v(" "),r("p",[a._v("任务格式：")]),a._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[a._v("minute   hour   day   month   week   command     \n")])]),a._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[a._v("1")]),r("br")])]),r("p",[r("img",{attrs:{src:s(534),alt:"crontab1"}})]),a._v(" "),r("ul",[r("li",[r("p",[a._v("minute： 表示分钟，可以是从 0 到 59 之间的任何整数")])]),a._v(" "),r("li",[r("p",[a._v("hour：表示小时，可以是从 0 到 23 之间的任何整数")])]),a._v(" "),r("li",[r("p",[a._v("day：表示日期，可以是从 1 到 31 之间的任何整数")])]),a._v(" "),r("li",[r("p",[a._v("month：表示月份，可以是从 1 到 12 之间的任何整数")])]),a._v(" "),r("li",[r("p",[a._v("week：表示星期几，可以是从 0 到 7 之间的任何整数，这里的 0 或 7 代表星期日")])]),a._v(" "),r("li",[r("p",[a._v("command：要执行的命令，可以是系统命令，也可以是自己编写的脚本文件")])])]),a._v(" "),r("p",[r("strong",[a._v("在以上各个字段中，还可以使用以下特殊字符：")])]),a._v(" "),r("p",[a._v("星号（*）：代表所有可能的值，例如 month 字段如果是星号，则表示在满足其它字段的制约条件后每月都执行该命令操作")]),a._v(" "),r("p",[a._v("逗号（,）：可以用逗号隔开的值指定一个列表范围，例如，“1,2,5,7,8,9”")]),a._v(" "),r("p",[a._v("中杠（-）：可以用整数之间的中杠表示一个整数范围，例如 “2-6” 表示 “2,3,4,5,6”")]),a._v(" "),r("p",[a._v("正斜线（/）：可以用正斜线指定时间的间隔频率，例如 “0-23/2” 表示每两小时执行一次，同时正斜线可以和星号一起使用，例如 */10，如果用在 minute字段，表示每十分钟执行一次")]),a._v(" "),r("h3",{attrs:{id:"使用实例"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#使用实例"}},[a._v("#")]),a._v(" 使用实例")]),a._v(" "),r("p",[r("strong",[a._v("实例1")]),a._v("：每 1 分钟执行一次 command")]),a._v(" "),r("p",[r("strong",[a._v("命令：")])]),a._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[a._v("* * * * * command\n")])]),a._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[a._v("1")]),r("br")])]),r("p",[r("strong",[a._v("实例2")]),a._v("： 每小时的第 3 和第 15 分钟执行")]),a._v(" "),r("p",[r("strong",[a._v("命令：")])]),a._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[a._v("3,15 * * * * command\n")])]),a._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[a._v("1")]),r("br")])]),r("p",[r("strong",[a._v("实例3")]),a._v("：每隔两天的上午 8点 到 11点 的第 3 和第 15 分钟执行")]),a._v(" "),r("p",[r("strong",[a._v("命令：")])]),a._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[a._v("3,15 8-11 */2 * * command\n")])]),a._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[a._v("1")]),r("br")])]),r("p",[r("strong",[a._v("实例4")]),a._v("：每周六、周日的 1 : 10 重启 smb")]),a._v(" "),r("p",[r("strong",[a._v("命令：")])]),a._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[a._v("10 1 * * 6,0 /etc/init.d/smb restart\n")])]),a._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[a._v("1")]),r("br")])]),r("h2",{attrs:{id:"crond服务操作命令"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#crond服务操作命令"}},[a._v("#")]),a._v(" Crond服务操作命令")]),a._v(" "),r("ul",[r("li",[r("p",[r("code",[a._v("yum install crontabs")]),a._v("   安装 crontab")])]),a._v(" "),r("li",[r("p",[r("code",[a._v("/sbin/service crond start")]),a._v("     启动服务")])]),a._v(" "),r("li",[r("p",[r("code",[a._v("/sbin/service crond stop")]),a._v("     关闭服务")])]),a._v(" "),r("li",[r("p",[r("code",[a._v("/sbin/service crond restart")]),a._v("     重启服务")])]),a._v(" "),r("li",[r("p",[r("code",[a._v("/sbin/service crond reload")]),a._v("     重新载入配置")])]),a._v(" "),r("li",[r("p",[r("code",[a._v("/sbin/service crond status")]),a._v("    服务是否运行")])])]),a._v(" "),r("h2",{attrs:{id:"使用注意事项"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#使用注意事项"}},[a._v("#")]),a._v(" 使用注意事项")]),a._v(" "),r("h3",{attrs:{id:"环境变量问题"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#环境变量问题"}},[a._v("#")]),a._v(" 环境变量问题")]),a._v(" "),r("p",[a._v("问题：任务无法自动执行，但却可以手动执行")]),a._v(" "),r("p",[a._v("原因：在 crontab 文件中没有指定环境变量，而系统执行任务时，不会加载任何环境变量")]),a._v(" "),r("p",[a._v("注意：")]),a._v(" "),r("ul",[r("li",[r("p",[a._v("脚本中涉及文件路径时写全局路径")])]),a._v(" "),r("li",[r("p",[a._v("脚本执行需要用到 Java 或其他环境变量时，通过 source 命令引入环境变量，如：")]),a._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[a._v("cat start_cbp.sh\n\n#!/bin/sh\n\nsource /etc/profile\n\nexport RUN_CONF=/home/d139/conf/platform/cbp/cbp_jboss.conf\n\n/usr/local/jboss-4.0.5/bin/run.sh -c mev &\n")])]),a._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[a._v("1")]),r("br"),r("span",{staticClass:"line-number"},[a._v("2")]),r("br"),r("span",{staticClass:"line-number"},[a._v("3")]),r("br"),r("span",{staticClass:"line-number"},[a._v("4")]),r("br"),r("span",{staticClass:"line-number"},[a._v("5")]),r("br"),r("span",{staticClass:"line-number"},[a._v("6")]),r("br"),r("span",{staticClass:"line-number"},[a._v("7")]),r("br"),r("span",{staticClass:"line-number"},[a._v("8")]),r("br"),r("span",{staticClass:"line-number"},[a._v("9")]),r("br")])])]),a._v(" "),r("li",[r("p",[a._v("手动执行脚本 OK 时，但是 crontab 不执行，可以尝试在 crontab 中直接引入环境变量解决问题，如：")]),a._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[a._v("0 * * * * . /etc/profile;/bin/sh /var/www/java/audit_no_count/bin/restart_audit.sh\n")])]),a._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[a._v("1")]),r("br")])])])]),a._v(" "),r("h3",{attrs:{id:"清理系统用户的邮件日志"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#清理系统用户的邮件日志"}},[a._v("#")]),a._v(" "),r("strong",[a._v("清理系统用户的邮件日志")])]),a._v(" "),r("p",[a._v("问题：系统调度执行完成后，会输出信息，长期执行时，会导致日志信息会非常大")]),a._v(" "),r("p",[a._v("解决：将输出进行重定向")]),a._v(" "),r("div",{staticClass:"language- line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[a._v("0 */3 * * * /usr/local/apache2/apachectl restart >/dev/null 2>&1\n")])]),a._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[a._v("1")]),r("br")])]),r("p",[r("code",[a._v("/dev/null 2>&1")]),a._v(" ： 先将标准输出重定向到 "),r("code",[a._v("/dev/null")]),a._v("，然后将标准错误重定向到标准输出")]),a._v(" "),r("h3",{attrs:{id:"系统级与用户级任务调度"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#系统级与用户级任务调度"}},[a._v("#")]),a._v(" 系统级与用户级任务调度")]),a._v(" "),r("ul",[r("li",[a._v("可以将用户级任务调度放到系统级任务调度中完成，一般不建议做")]),a._v(" "),r("li",[a._v("不可以将系统级任务调度放到用户级任务调度中完成")]),a._v(" "),r("li",[a._v("要定义一个定时重启系统的任务，就必须将任务放到 "),r("code",[a._v("/etc/crontab")]),a._v("文件，即使在 root 用户下创建一个定时重启系统的任务也是无效的")])]),a._v(" "),r("h3",{attrs:{id:"其他注意事项"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#其他注意事项"}},[a._v("#")]),a._v(" 其他注意事项")]),a._v(" "),r("ul",[r("li",[a._v("新创建的 job 在不重启 cron 时，不会马上执行，至少要过 2 分钟才执行")]),a._v(" "),r("li",[a._v("当 crontab 突然失效时，可以尝试 "),r("code",[a._v("/etc/init.d/crond restart")]),a._v(" 或者查看日志看某个 job 有没有执行报错 "),r("code",[a._v("tail -f /var/log/cron")])]),a._v(" "),r("li",[a._v("谨慎使用  "),r("code",[a._v("crontab -r")]),a._v("，会删除用户的 Crontab 文件")]),a._v(" "),r("li",[a._v("在 crontab 中 % 是有特殊含义的，需要使用 "),r("code",[a._v("\\%")]),a._v(" 转义")])])])}),[],!1,null,null,null);t.default=v.exports},533:function(a,t,s){a.exports=s.p+"assets/img/crontab.809ade70.png"},534:function(a,t,s){a.exports=s.p+"assets/img/crontab1.c3bcc151.png"}}]);