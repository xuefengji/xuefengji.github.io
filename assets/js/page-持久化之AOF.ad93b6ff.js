(window.webpackJsonp=window.webpackJsonp||[]).push([[272],{1158:function(s,a,t){"use strict";t.r(a);var e=t(1),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"持久化之-aof"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#持久化之-aof"}},[s._v("#")]),s._v(" 持久化之 AOF")]),s._v(" "),e("h2",{attrs:{id:"什么是-aof"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#什么是-aof"}},[s._v("#")]),s._v(" 什么是 AOF")]),s._v(" "),e("p",[s._v("AOF：Append Only File")]),s._v(" "),e("ul",[e("li",[s._v("以日志的形式记录每个写的操作")]),s._v(" "),e("li",[s._v("只许追加文件，但不可以改写文件")]),s._v(" "),e("li",[s._v("Redis 启动时会读取这个文件，将所有指令重新执行")]),s._v(" "),e("li",[s._v("默认不开启，需要修改配置文件手动开启")]),s._v(" "),e("li",[s._v("AOF 保存的是 appendonly.aof 文件")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Please check https://redis.io/topics/persistence for more information.")]),s._v("\nappendonly no\n\nappendfilename "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"appendonly.aof"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("修改配置文件后，重启 Redis 即可")]),s._v(" "),e("p",[s._v("默认文件路径在 appendonlydir 目录下")]),s._v(" "),e("p",[e("img",{attrs:{src:t(609),alt:"aof"}})]),s._v(" "),e("h2",{attrs:{id:"实现原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实现原理"}},[s._v("#")]),s._v(" 实现原理")]),s._v(" "),e("p",[e("img",{attrs:{src:t(610),alt:"aof"}})]),s._v(" "),e("p",[s._v("连接 Redis 进行一些操作后，查看该文件:")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" key1 v1\nOK\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" key2 v2\nOK\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" key3 v3\nOK\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[e("img",{attrs:{src:t(611),alt:"aof"}})]),s._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),e("p",[s._v("如果 AOF 文件有错误，这时 Redis 是启动不成功的，需要修复这个 AOF 文件")]),s._v(" "),e("p",[s._v("Redis 给我们提供了一个工具 "),e("code",[s._v("redis-check-aof --fix")])])]),s._v(" "),e("p",[e("img",{attrs:{src:t(612),alt:"aof"}})]),s._v(" "),e("p",[s._v("文件正常后就可以正常启动")]),s._v(" "),e("h2",{attrs:{id:"aof-优缺点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#aof-优缺点"}},[s._v("#")]),s._v(" AOF 优缺点")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("appendonly no                "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#默认是不开启 aof模式的，默认是使用 rdb 方式持久化的，在大部分所有的情况下，rdb 完全够用！")]),s._v("\nappendfilename "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"appendonly.aof"')]),s._v("    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#持久化的文件的名字")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# appendfsync always               #每次修改都会 sync，消耗性能")]),s._v("\nappendfsync everysec               "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#每秒执行一次 sync，可能会丢失这 1s 的数据！")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# appendfsync no                   #不执行 sync，这个时候操作系统自己同步数据，速度最快！")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[e("strong",[s._v("优点")]),s._v("：")]),s._v(" "),e("ul",[e("li",[s._v("每一次修改都会同步，文件的完整性会更加好")]),s._v(" "),e("li",[s._v("没秒同步一次，可能会丢失一秒的数据")]),s._v(" "),e("li",[s._v("从不同步，效率最高")])]),s._v(" "),e("p",[e("strong",[s._v("缺点")]),s._v("：")]),s._v(" "),e("ul",[e("li",[s._v("相对于数据文件来说，AOF 远远大于 RDB，修复速度比 RDB 慢！")]),s._v(" "),e("li",[s._v("AOF 运行效率也要比  RDB 慢，所以我们redis默认的配置就是 RDB 持久化")])]),s._v(" "),e("p",[s._v("（完）")])])}),[],!1,null,null,null);a.default=n.exports},609:function(s,a,t){s.exports=t.p+"assets/img/aof1.e68ac3af.png"},610:function(s,a,t){s.exports=t.p+"assets/img/aof3.719121cc.png"},611:function(s,a,t){s.exports=t.p+"assets/img/aof2.11ea13c9.png"},612:function(s,a,t){s.exports=t.p+"assets/img/aof4.bd87bf42.png"}}]);