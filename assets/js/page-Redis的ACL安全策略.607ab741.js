(window.webpackJsonp=window.webpackJsonp||[]).push([[119],{1157:function(s,a,t){"use strict";t.r(a);var e=t(1),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"redis-的-acl-安全策略"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-的-acl-安全策略"}},[s._v("#")]),s._v(" Redis 的 ACL 安全策略")]),s._v(" "),t("blockquote",[t("p",[s._v("ACL 是 Redis 6.0 的新特性，主要是做权限控制的")]),s._v(" "),t("p",[s._v("它的出现是因为在 Redis 6.0 版本之前是没有权限的概念的，所有连接的客户端都可以对 Redis 里面的数据进行操作，也可以使用所有高危命令，比如 "),t("code",[s._v("flushall")]),s._v(" 或 "),t("code",[s._v("flushdb")]),s._v(" 清空掉数据库里面的所有数据")])]),s._v(" "),t("h2",{attrs:{id:"背景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),t("p",[s._v("最近给新安装的 Redis 设置密码时，按照以前的方式，因为在 Redis 6.0 之前，Redis 只有一个 default 用户也是 Redis 中的超级管理员用户，所以要将其设置密码，只需要修改 Redis 配置文件中如下项：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("requirepass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("然后重启 Redis 就可以了。")]),s._v(" "),t("p",[s._v("这就是在 Redis 6.0 之前给 Redis 用户创建密码的方式，只有一个 "),t("code",[s._v("default")]),s._v(" 用户也是 Redis 中的超级管理员用户")]),s._v(" "),t("p",[s._v("但是这次安装的是 Redis 7，在一次开启公网调试并用代码访问时，发现通过配置文件设置的密码并未生效。又重新看了下配置文件，果然在这一项的上面注释中写着："),t("code",[s._v("requirepass")]),s._v(" 与 ACL 不兼容，如果开启了 ACL，那么这项配置将被忽略")]),s._v(" "),t("p",[s._v("看来有必要了解一下 ACL 这个新特性了")]),s._v(" "),t("h2",{attrs:{id:"acl-简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#acl-简介"}},[s._v("#")]),s._v(" ACL 简介")]),s._v(" "),t("p",[s._v("在 Redis 6.0 之前的版本，我们只能使用 "),t("code",[s._v("requirepass")]),s._v(" 参数给 "),t("code",[s._v("default")]),s._v(" 用户配置登录密码，同一个 Redis 集群的所有开发都共享 "),t("code",[s._v("default")]),s._v(" 用户，难免会出现误操作把别人的 key 删掉或者数据泄露的情况")]),s._v(" "),t("p",[s._v("因此 Redis 6.0 版本推出了 ACL（Access Controller List）访问控制权限的功能，基于此功能，我们可以设置多个用户，并且给每个用户单独设置命令权限和数据权限。在用户连接之后，它的工作方式是需要客户端进行身份验证，以提供用户名和有效密码：如果身份验证阶段成功，则连接与给定用户关联，并且该用户具有限制")]),s._v(" "),t("p",[s._v("为了保证向下兼容，Redis 6.0 保留了 "),t("code",[s._v("default")]),s._v(" 用户和使用 "),t("code",[s._v("requirepass")]),s._v(" 的方式给 "),t("code",[s._v("default")]),s._v(" 用户设置密码，默认情况下 "),t("code",[s._v("default")]),s._v(" 用户拥有 Redis 最大权限，我们使用 redis-cli 连接时如果没有指定用户名，用户也是默认 "),t("code",[s._v("default")])]),s._v(" "),t("h2",{attrs:{id:"配置-acl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置-acl"}},[s._v("#")]),s._v(" 配置 ACL")]),s._v(" "),t("p",[s._v("配置 ACL 的方式有两种，一种是在 conf 文件中直接配置，另一种是在外部 aclfile 中配置。配置的命令是一样的，"),t("strong",[s._v("但是两种方式只能选择其中一种")])]),s._v(" "),t("p",[s._v("在讲具体的配置方式之前，需要先简单介绍一下定义 ACL 时用到的 DSL 语法")]),s._v(" "),t("h3",{attrs:{id:"dsl-语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dsl-语法"}},[s._v("#")]),s._v(" DSL 语法")]),s._v(" "),t("p",[s._v("ACL 是使用 DSL 定义的，该 DSL 就是一个规则，描述了指定用户可以执行的操作，且是按照从左到右、从第一个到最后一个的顺序实施，因为有时规则的顺序对于理解用户的实际能力很重要")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("小贴士")]),s._v(" "),t("p",[s._v("DSL（domain specific language）是领域专用语言，其基本思想是「求专不求全」，不像通用目的语言那样目标范围涵盖一切软件问题，而是具有受限的表达，专门针对某一特定问题的计算机语言")]),s._v(" "),t("ul",[t("li",[s._v("Java、Python、C 都是通用性编程语言，也就是我们可以用于多个不同的领域，普通应用编程")]),s._v(" "),t("li",[s._v("HTML、SQL 都算得上是领域专用语言，需要寄生在宿主语言中。比如 React 或者 Vue 支持的 JSX 语法都属于 DSL，「寄生」于前端 HTML 中")])])]),s._v(" "),t("p",[s._v("以查看默认用户的 ACL 为例，默认情况下，只有一个用户定义，称为 "),t("code",[s._v("default")]),s._v("。我们可以使用 "),t("a",{attrs:{href:"https://redis.io/commands/acl-list/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("ACL LIST")]),t("OutboundLink")],1),s._v(" 命令来检查当前活动的 ACL 并验证新启动的，默认的 Redis 实例的配置是：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-16-7-centos ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis-cli -h 127.0.0.1 -p 6379")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl list\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user default on nopass sanitize-payload ~* &* +@all"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("解释一下返回值：")]),s._v(" "),t("ul",[t("li",[s._v("第一个是固定单词 "),t("code",[s._v("user")]),s._v("，后面跟上用户名（此处是 "),t("code",[s._v("default")]),s._v("）")]),s._v(" "),t("li",[s._v("默认用户已配置为活动状态（"),t("code",[s._v("on")]),s._v("），不需要密码（"),t("code",[s._v("nopass")]),s._v("）")]),s._v(" "),t("li",[s._v("权限是访问所有可能的键（"),t("code",[s._v("~*")]),s._v("）和 发布/订阅（Pub/Sub）频道（"),t("code",[s._v("&*")]),s._v("），并能够调用所有可能的命令（"),t("code",[s._v("+@all")]),s._v("）")])]),s._v(" "),t("p",[s._v("对于这个默认用户，具有 "),t("code",[s._v("nopass")]),s._v(" 规则意味着新连接将自动与默认用户进行身份验证，而无需任何显式的 auth 调用")]),s._v(" "),t("p",[s._v("至于 ACL 规则用 DSL 怎么写，最后再讲，现在有个大概的概念就行。下面展开来讲两种配置方式")]),s._v(" "),t("h3",{attrs:{id:"使用-conf-配置-acl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-conf-配置-acl"}},[s._v("#")]),s._v(" 使用 conf 配置 ACL")]),s._v(" "),t("p",[s._v("我们之前使用 "),t("code",[s._v("requirepass")]),s._v(" 给 "),t("code",[s._v("default")]),s._v(" 用户设置密码默认就是使用的 conf 方式。并且 6.0 版本开始，在用之前方式给 "),t("code",[s._v("default")]),s._v(" 用户配置密码后，再执行 "),t("code",[s._v("config rewrite")]),s._v(" 重写配置，就会自动在 conf 文件最下面新增一行记录来配置 "),t("code",[s._v("default")]),s._v(" 的密码和权限")]),s._v(" "),t("p",[s._v("使用 conf 文件配置 default 和其他用户的 ACL 权限，操作步骤如下：")]),s._v(" "),t("h4",{attrs:{id:"_1-第一步-在-conf-文件中配置-default-用户的密码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-第一步-在-conf-文件中配置-default-用户的密码"}},[s._v("#")]),s._v(" 1）第一步，在 conf 文件中配置 "),t("code",[s._v("default")]),s._v(" 用户的密码")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The requirepass is not compatible with aclfile option and the ACL LOAD")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# command, these will cause requirepass to be ignored.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\nrequirepass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"_2-第二步-重启-redis-服务-进入命令行执行-config-rewrite-命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-第二步-重启-redis-服务-进入命令行执行-config-rewrite-命令"}},[s._v("#")]),s._v(" 2）第二步，重启 redis 服务，进入命令行执行 "),t("code",[s._v("config rewrite")]),s._v(" 命令")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-16-7-centos ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis-cli -h 127.0.0.1 -p 6379")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" config rewrite\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("这时候可以看到 conf 文件的最后面自动新增了 "),t("code",[s._v("default")]),s._v(" 用户的 ACL，如下所示：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("user default on nopass sanitize-payload ~* "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("* +@all\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"_3-在-conf-文件中注释-aclfile-的路径配置-默认是注释的"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-在-conf-文件中注释-aclfile-的路径配置-默认是注释的"}},[s._v("#")]),s._v(" 3）在 conf 文件中注释 aclfile 的路径配置（默认是注释的）")]),s._v(" "),t("p",[s._v("原因是因为两种配置方式（conf 方式和 aclfile 方式）是冲突的，只能开启一个。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Using an external ACL file")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Instead of configuring users here in this file, it is possible to use")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# a stand-alone file just listing users. The two methods cannot be mixed:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# if you configure users here and at the same time you activate the external")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ACL file, the server will refuse to start.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The format of the external ACL user file is exactly the same as the")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# format that is used inside redis.conf to describe users.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# aclfile /etc/redis/users.acl")]),s._v("\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h4",{attrs:{id:"_4-重启-redis-服务来加载配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-重启-redis-服务来加载配置"}},[s._v("#")]),s._v(" 4）重启 Redis 服务来加载配置")]),s._v(" "),t("p",[s._v("加载配置需要重启 Redis 服务。")]),s._v(" "),t("h4",{attrs:{id:"_5-查看新的-acl-list"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-查看新的-acl-list"}},[s._v("#")]),s._v(" 5）查看新的 acl list")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-16-7-centos ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis-cli -h 127.0.0.1 -p 6379")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl list\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user default on nopass sanitize-payload ~* &* +@all"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("因此我们可以直接在 conf 配置文件中，使用类似上面 "),t("code",[s._v("default")]),s._v(" 用户的这行 DSL 命令来设置用户权限，或者我们也可以配置外部 aclfile 配置权限")]),s._v(" "),t("h3",{attrs:{id:"使用外部-aclfile-配置-acl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用外部-aclfile-配置-acl"}},[s._v("#")]),s._v(" 使用外部 aclfile 配置 ACL")]),s._v(" "),t("blockquote",[t("p",[s._v("如果我们有较多的用户且希望有一个单独的配置文件时，可以使用这种方式")])]),s._v(" "),t("p",[s._v("配置 aclfile 需要先将 conf 中配置的 DSL 注释掉或直接删除，因为 Redis 不允许两种 ACL 管理方式同时使用，否则在启动 Redis的时候会报下面的错误：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Configuring Redis with users defined in redis.conf and at the same setting an ACL file path is invalid. This setup is very likely to lead to configuration errors and security holes, please define either an ACL file or declare users directly in your redis.conf, but not both.")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("使用外部 aclfile 文件配置 "),t("code",[s._v("default")]),s._v(" 和其他用户的 ACL 权限，操作步骤如下：")]),s._v(" "),t("h4",{attrs:{id:"_1-第一步-注释-conf-文件中所有已授权的-acl-命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-第一步-注释-conf-文件中所有已授权的-acl-命令"}},[s._v("#")]),s._v(" 1）第一步，注释 conf 文件中所有已授权的 ACL 命令")]),s._v(" "),t("p",[s._v("如果先前是用 "),t("code",[s._v("config rewrite")]),s._v(" 命令生成的 ACL 语句，那么它们一般是在 conf 文件最末尾，例如 "),t("code",[s._v("default")]),s._v(" 用户的这行，把它注释掉：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# user default on nopass sanitize-payload ~* &* +@all")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"_2-第二步-在-conf-文件中配置外部-aclfile-路径"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-第二步-在-conf-文件中配置外部-aclfile-路径"}},[s._v("#")]),s._v(" 2）第二步，在 conf 文件中配置外部 aclfile 路径")]),s._v(" "),t("ul",[t("li",[s._v("在 conf 文件中注释掉 "),t("code",[s._v("default")]),s._v(" 用户的密码，因为开启 aclfile 之后，"),t("code",[s._v("requirepass")]),s._v(" 的密码就失效了")]),s._v(" "),t("li",[s._v("在 conf 文件中配置 aclfile 的路径，然后创建该文件，否则重启 Redis 服务会报错找不到该文件")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("div",{staticClass:"highlight-lines"},[t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("br"),t("div",{staticClass:"highlighted"},[s._v(" ")]),t("br")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Using an external ACL file")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Instead of configuring users here in this file, it is possible to use")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# a stand-alone file just listing users. The two methods cannot be mixed:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# if you configure users here and at the same time you activate the external")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ACL file, the server will refuse to start.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The format of the external ACL user file is exactly the same as the")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# format that is used inside redis.conf to describe users.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\naclfile /usr/local/redis/acl/users.acl\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# IMPORTANT NOTE: starting with Redis 6 "requirepass" is just a compatibility')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# layer on top of the new ACL system. The option effect will be just setting")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# the password for the default user. Clients will still authenticate using")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# AUTH <password> as usually, or more explicitly with AUTH default <password>")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# if they follow the new protocol: both will work.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The requirepass is not compatible with aclfile option and the ACL LOAD")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# command, these will cause requirepass to be ignored.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# requirepass 123456")]),s._v("\n")])]),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[s._v("新建一个文件夹 "),t("code",[s._v("acl/")]),s._v("，然后新建一个文件 "),t("code",[s._v("users.acl")]),s._v("，将用户权限相关的配置（DSL 语法）拷贝到 "),t("code",[s._v("users.acl")]),s._v(" 中：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/redis/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" acl\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" acl\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" users.acl\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("然后将信息写入到配置文件中：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("user default on nopass sanitize-payload ~* "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("* +@all\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("上面这段 DSL 是从前面复制的，由"),t("code",[s._v("config rewrite")]),s._v(" 命令生成的。也就是有最高权限的 "),t("code",[s._v("default")]),s._v(" 用户")]),s._v(" "),t("h4",{attrs:{id:"_3-第三步-重启-redis-服务来加载配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-第三步-重启-redis-服务来加载配置"}},[s._v("#")]),s._v(" 3）第三步，重启 Redis 服务来加载配置")]),s._v(" "),t("p",[s._v("加载配置需要重启 Redis 服务")]),s._v(" "),t("p",[s._v("PS：经测试，首次将 conf 方式改为 aclfile 方式，必须要重启 Redis 服务才行（否则会报错 "),t("code",[s._v("(error) ERR This Redis instance is not configured to use an ACL file.（此处省略 100 字）")]),s._v("）")]),s._v(" "),t("p",[s._v("而以后修改 "),t("code",[s._v("users.acl")]),s._v(" 文件里面的 DSL 语句后，只需要在命令行执行 "),t("code",[s._v("acl load")]),s._v(" 即可将将最新的 aclfile 中的权限加载至 Redis服务中）")]),s._v(" "),t("h4",{attrs:{id:"_4-查看新的-acl-list"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-查看新的-acl-list"}},[s._v("#")]),s._v(" 4）查看新的 acl list")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-16-7-centos ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis-cli -h 127.0.0.1 -p 6379")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl list\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user default on nopass sanitize-payload ~* &* +@all"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"对比-conf-和-aclfile-两种方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#对比-conf-和-aclfile-两种方式"}},[s._v("#")]),s._v(" 对比 conf 和 aclfile 两种方式")]),s._v(" "),t("p",[s._v("在 conf 和 aclfile 两种方式中配置 DSL，官方更推荐使用 aclfile，因为如果在 conf 中配置了权限之后需要重启 redis 服务才能将配置的权限加载至 Redis 服务中来，但如果使用 aclfile 模式，可以调用 "),t("code",[s._v("acl load")]),s._v(" 命令将 aclfile 中配置的 ACL 权限热加载进环境中，类似于 MySQL 中的 "),t("code",[s._v("flush privileges")])]),s._v(" "),t("p",[t("svg",{attrs:{id:"SvgjsSvg1006",width:"611",height:"235",xmlns:"http://www.w3.org/2000/svg",version:"1.1","xmlns:xlink":"http://www.w3.org/1999/xlink","xmlns:svgjs":"http://svgjs.com/svgjs"}},[t("defs",{attrs:{id:"SvgjsDefs1007"}}),t("g",{attrs:{id:"SvgjsG1008",transform:"translate(25,67)"}},[t("path",{attrs:{id:"SvgjsPath1009",d:"M0 0L165.9999 0L165.9999 35.75 L0 35.75Z",stroke:"rgba(201,208,227,1)","stroke-width":"1","fill-opacity":"1",fill:"#f5f7fb"}}),t("path",{attrs:{id:"SvgjsPath1010",d:"M165.9999 0L373.96259999999995 0L373.96259999999995 35.75 L165.9999 35.75Z",stroke:"rgba(201,208,227,1)","stroke-width":"1","fill-opacity":"1",fill:"#f5f7fb"}}),t("path",{attrs:{id:"SvgjsPath1011",d:"M373.9626 0L561 0L561 35.75 L373.9626 35.75Z",stroke:"rgba(201,208,227,1)","stroke-width":"1","fill-opacity":"1",fill:"#f5f7fb"}}),t("path",{attrs:{id:"SvgjsPath1012",d:"M0 35.75L165.9999 35.75L165.9999 71.5 L0 71.5Z",stroke:"rgba(201,208,227,1)","stroke-width":"1","fill-opacity":"1",fill:"#ffffff"}}),t("path",{attrs:{id:"SvgjsPath1013",d:"M165.9999 35.75L373.96259999999995 35.75L373.96259999999995 71.5 L165.9999 71.5Z",stroke:"rgba(201,208,227,1)","stroke-width":"1","fill-opacity":"1",fill:"#ffffff"}}),t("path",{attrs:{id:"SvgjsPath1014",d:"M373.9626 35.75L561 35.75L561 71.5 L373.9626 71.5Z",stroke:"rgba(201,208,227,1)","stroke-width":"1","fill-opacity":"1",fill:"#ffffff"}}),t("path",{attrs:{id:"SvgjsPath1015",d:"M0 71.5L165.9999 71.5L165.9999 107.25 L0 107.25Z",stroke:"rgba(201,208,227,1)","stroke-width":"1","fill-opacity":"1",fill:"#ffffff"}}),t("path",{attrs:{id:"SvgjsPath1016",d:"M165.9999 71.5L373.96259999999995 71.5L373.96259999999995 107.25 L165.9999 107.25Z",stroke:"rgba(201,208,227,1)","stroke-width":"1","fill-opacity":"1",fill:"#ffffff"}}),t("path",{attrs:{id:"SvgjsPath1017",d:"M373.9626 71.5L561 71.5L561 107.25 L373.9626 107.25Z",stroke:"rgba(201,208,227,1)","stroke-width":"1","fill-opacity":"1",fill:"#ffffff"}}),t("path",{attrs:{id:"SvgjsPath1018",d:"M0 107.25L165.9999 107.25L165.9999 143 L0 143Z",stroke:"rgba(201,208,227,1)","stroke-width":"1","fill-opacity":"1",fill:"#ffffff"}}),t("path",{attrs:{id:"SvgjsPath1019",d:"M165.9999 107.25L373.96259999999995 107.25L373.96259999999995 143 L165.9999 143Z",stroke:"rgba(201,208,227,1)","stroke-width":"1","fill-opacity":"1",fill:"#ffffff"}}),t("path",{attrs:{id:"SvgjsPath1020",d:"M373.9626 107.25L561 107.25L561 143 L373.9626 143Z",stroke:"rgba(201,208,227,1)","stroke-width":"1","fill-opacity":"1",fill:"#ffffff"}}),t("g",{attrs:{id:"SvgjsG1021"}},[t("text",{attrs:{id:"SvgjsText1022","font-family":"微软雅黑","text-anchor":"start","font-size":"16px",width:"166px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"start",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"3.875",transform:"rotate(0)"}})]),t("g",{attrs:{id:"SvgjsG1023"}},[t("text",{attrs:{id:"SvgjsText1024","font-family":"微软雅黑","text-anchor":"start","font-size":"16px",width:"208px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"start",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"3.875",transform:"rotate(0)"}},[t("tspan",{attrs:{id:"SvgjsTspan1025",dy:"20",x:"165.9999"}},[t("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1026"}},[s._v("  redis.conf")])])])]),t("g",{attrs:{id:"SvgjsG1027"}},[t("text",{attrs:{id:"SvgjsText1028","font-family":"微软雅黑","text-anchor":"start","font-size":"16px",width:"188px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"start",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"3.875",transform:"rotate(0)"}},[t("tspan",{attrs:{id:"SvgjsTspan1029",dy:"20",x:"373.9626"}},[t("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1030"}},[s._v("  users.acl")])])])]),t("g",{attrs:{id:"SvgjsG1031"}},[t("text",{attrs:{id:"SvgjsText1032","font-family":"微软雅黑","text-anchor":"start","font-size":"16px",width:"166px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"start",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"39.625",transform:"rotate(0)"}},[t("tspan",{attrs:{id:"SvgjsTspan1033",dy:"20",x:"0"}},[t("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1034"}},[s._v("  配置方式")])])])]),t("g",{attrs:{id:"SvgjsG1035"}},[t("text",{attrs:{id:"SvgjsText1036","font-family":"微软雅黑","text-anchor":"start","font-size":"16px",width:"208px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"start",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"39.625",transform:"rotate(0)"}},[t("tspan",{attrs:{id:"SvgjsTspan1037",dy:"20",x:"165.9999"}},[t("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1038"}},[s._v("  DSL")])])])]),t("g",{attrs:{id:"SvgjsG1039"}},[t("text",{attrs:{id:"SvgjsText1040","font-family":"微软雅黑","text-anchor":"start","font-size":"16px",width:"188px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"start",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"39.625",transform:"rotate(0)"}},[t("tspan",{attrs:{id:"SvgjsTspan1041",dy:"20",x:"373.9626"}},[t("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1042"}},[s._v("  DSL")])])])]),t("g",{attrs:{id:"SvgjsG1043"}},[t("text",{attrs:{id:"SvgjsText1044","font-family":"微软雅黑","text-anchor":"start","font-size":"16px",width:"166px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"start",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"75.375",transform:"rotate(0)"}},[t("tspan",{attrs:{id:"SvgjsTspan1045",dy:"20",x:"0"}},[t("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1046"}},[s._v("  加载 ACL 配置")])])])]),t("g",{attrs:{id:"SvgjsG1047"}},[t("text",{attrs:{id:"SvgjsText1048","font-family":"微软雅黑","text-anchor":"start","font-size":"16px",width:"208px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"start",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"75.375",transform:"rotate(0)"}},[t("tspan",{attrs:{id:"SvgjsTspan1049",dy:"20",x:"165.9999"}},[t("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1050"}},[s._v("  重启 Redis 服务")])])])]),t("g",{attrs:{id:"SvgjsG1051"}},[t("text",{attrs:{id:"SvgjsText1052","font-family":"微软雅黑","text-anchor":"start","font-size":"16px",width:"188px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"start",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"75.375",transform:"rotate(0)"}},[t("tspan",{attrs:{id:"SvgjsTspan1053",dy:"20",x:"373.9626"}},[t("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1054"}},[s._v("  ACL LOAD 命令")])])])]),t("g",{attrs:{id:"SvgjsG1055"}},[t("text",{attrs:{id:"SvgjsText1056","font-family":"微软雅黑","text-anchor":"start","font-size":"16px",width:"166px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"start",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"111.125",transform:"rotate(0)"}},[t("tspan",{attrs:{id:"SvgjsTspan1057",dy:"20",x:"0"}},[t("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1058"}},[s._v("  持久化 ACL 配置")])])])]),t("g",{attrs:{id:"SvgjsG1059"}},[t("text",{attrs:{id:"SvgjsText1060","font-family":"微软雅黑","text-anchor":"start","font-size":"16px",width:"208px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"start",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"111.125",transform:"rotate(0)"}},[t("tspan",{attrs:{id:"SvgjsTspan1061",dy:"20",x:"165.9999"}},[t("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1062"}},[s._v("  CONFIG REWRITE 命令")])])])]),t("g",{attrs:{id:"SvgjsG1063"}},[t("text",{attrs:{id:"SvgjsText1064","font-family":"微软雅黑","text-anchor":"start","font-size":"16px",width:"188px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"start",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"111.125",transform:"rotate(0)"}},[t("tspan",{attrs:{id:"SvgjsTspan1065",dy:"20",x:"373.9626"}},[t("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1066"}},[s._v("  ACL SAVE 命令")])])])])]),t("g",{attrs:{id:"SvgjsG1067",transform:"translate(168,25)"}},[t("path",{attrs:{id:"SvgjsPath1068",d:"M 0 0L 250 0L 250 39L 0 39Z",stroke:"none",fill:"none"}}),t("g",{attrs:{id:"SvgjsG1069"}},[t("text",{attrs:{id:"SvgjsText1070","font-family":"微软雅黑","text-anchor":"middle","font-size":"16px",width:"250px",fill:"#323232","font-weight":"400",align:"middle",lineHeight:"125%",anchor:"middle",family:"微软雅黑",size:"16px",weight:"400","font-style":"",opacity:"1",y:"5.5",transform:"rotate(0)"}},[t("tspan",{attrs:{id:"SvgjsTspan1071",dy:"20",x:"125"}},[t("tspan",{staticStyle:{},attrs:{id:"SvgjsTspan1072"}},[s._v("对比 conf 和 aclfile 两种方式")])])])])])])]),s._v(" "),t("h2",{attrs:{id:"通过命令行来管理用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通过命令行来管理用户"}},[s._v("#")]),s._v(" 通过命令行来管理用户")]),s._v(" "),t("p",[s._v("上面可以看到，我们在安装好 Redis 后，需要通过编辑文件来选择使用哪种 ACL 模式（conf 还是外部 aclfile）。并且我们知道无论哪种方式，里面都是存一些 DSL 语句，那么自然我们可以直接在配置文件中配置各用户的 ACL 权限，但每次编辑完后都需要执行 "),t("code",[s._v("ACL LOAD")]),s._v(" 或者重启 Redis 服务才能生效")]),s._v(" "),t("p",[s._v("事实上我们可以直接在命令行下配置 ACL，"),t("strong",[s._v("在命令行模式下配置的权限无需重启服务即可生效")])]),s._v(" "),t("p",[s._v("只是我们在命令行模式下配置 ACL 后，必须要将其持久化到 aclfile 或者 conf 文件中，因为只有将权限持久化，下次重启才会自动加载该权限，"),t("strong",[s._v("如果忘记持久化，一旦服务宕机或重启，该权限就会丢失")])]),s._v(" "),t("h3",{attrs:{id:"持久化的方式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#持久化的方式"}},[s._v("#")]),s._v(" 持久化的方式")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果使用 conf 模式，将 ACL 权限持久化到 redis.conf 文件中使用下面的命令：")]),s._v("\nconfig rewrite\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果使用 aclfile 模式，将 ACL 权限持久化到 users.acl 文件中使用下面的命令：")]),s._v("\nacl save\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[s._v("下面看如何使用命令来创建、编辑用户以及它们的 ACL。")]),s._v(" "),t("h3",{attrs:{id:"增删改查用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#增删改查用户"}},[s._v("#")]),s._v(" 增删改查用户")]),s._v(" "),t("h4",{attrs:{id:"_1-创建和修改用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建和修改用户"}},[s._v("#")]),s._v(" 1）创建和修改用户")]),s._v(" "),t("p",[s._v("使用 "),t("a",{attrs:{href:"https://redis.io/commands/acl-setuser/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("ACL SETUSER")]),t("OutboundLink")],1),s._v(" 命令来创建和编辑用户 ACL")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# username 区分大小写 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 若用户不存在，则按默认规则创建用户，并为其增加 <rules>。若用户存在则在已有规则上增加 <rules>")]),s._v("\nACL SETUSER "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("rules"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("默认规则下新增的用户处于非活跃状态，且没有密码，同时也没有任何命令和 key 的权限：")]),s._v(" "),t("div",{staticClass:"language-bash {1, 5} line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl setuser zhangsan\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl list\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user default on nopass sanitize-payload ~* &* +@all"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user zhangsan off resetchannels -@all"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("所以我们可以在新增用户时，指定一些规则，包含密码和权限等：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 lisi 用户，on 为活跃状态，密码为 123456，允许对所有 demo 开头的 key 使用 get 和 set 命令")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl setuser lisi on "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" ~demo* +get +set\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 让之前创建的 zhangsan 用户可用，并给它新增一个密码 123456")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl setuser zhangsan on "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 为 zhangsan 用户新增 list 类别下所有命令的权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl setuser zhangsan on +@list\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("查看现在的 "),t("code",[s._v("acl list")]),s._v("，可以发现密码都是一个 sha256 码的字符串，不是明文存储，还是比较安全的：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl list\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user default on nopass sanitize-payload ~* &* +@all"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user lisi on #8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92 ~demo* resetchannels -@all +get +set"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user zhangsan on #8d969eef6ecad3c29a3a629280e686cf0c3f5d5a86aff3ca12020c923adc6c92 resetchannels -@all +@list"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("需要注意的是，多次调用 "),t("code",[s._v("SETUSER")]),s._v(" 不会重置用户，而只会将 ACL 规则应用于现有用户。什么意思呢？")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl setuser zhangsan +get\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl setuser zhangsan +set\nOK\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("以上两次调用 "),t("code",[s._v("SETUSER")]),s._v(" 将导致 "),t("code",[s._v("zhangsan")]),s._v(" 这个用户能够调用 "),t("a",{attrs:{href:"https://redis.io/commands/get/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("GET")]),t("OutboundLink")],1),s._v(" 和 "),t("a",{attrs:{href:"https://redis.io/commands/set/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("SET")]),t("OutboundLink")],1)]),s._v(" "),t("h4",{attrs:{id:"_2-查询用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-查询用户"}},[s._v("#")]),s._v(" 2）查询用户")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有用户名")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("users")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看所有用户的 acl 信息")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl list\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看当前登录的用户名")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("whoami")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看指定用户的 ACL 权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl getuser "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h4",{attrs:{id:"_3-删除用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-删除用户"}},[s._v("#")]),s._v(" 3）删除用户")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除指定用户")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl deluser "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"登录和切换指定用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#登录和切换指定用户"}},[s._v("#")]),s._v(" 登录和切换指定用户")]),s._v(" "),t("h4",{attrs:{id:"_1-登录指定用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-登录指定用户"}},[s._v("#")]),s._v(" 1）登录指定用户")]),s._v(" "),t("p",[s._v("对于用 ACL 管理的用户，需要使用 "),t("code",[s._v("redis-cli --user xxx --pass yyy")]),s._v(" 来登陆：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-16-7-centos ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis-cli -h 127.0.0.1 -p 6379 --user lisi --pass 123456")]),s._v("\nWarning: Using a password with "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-a'")]),s._v(" or "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-u'")]),s._v(" option on the "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" line interface may not be safe.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("whoami")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("error"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" NOPERM this user has no permissions to run the "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'acl|whoami'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-16-7-centos ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis-cli -h 127.0.0.1 -p 6379 --user wangwu --pass 123456")]),s._v("\nWarning: Using a password with "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-a'")]),s._v(" or "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-u'")]),s._v(" option on the "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" line interface may not be safe.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("whoami")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wangwu"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h4",{attrs:{id:"_2-切换到指定用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-切换到指定用户"}},[s._v("#")]),s._v(" 2）切换到指定用户")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 auth 命令切换用户")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" auth "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("password"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"热加载命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#热加载命令"}},[s._v("#")]),s._v(" 热加载命令")]),s._v(" "),t("p",[s._v("如果直接在 aclfile 中修改或新增 ACL 权限，修改之后不会立刻生效，需要执行如下命令将配置热加载至 Redis 服务中")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl load\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"持久化命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#持久化命令"}},[s._v("#")]),s._v(" 持久化命令")]),s._v(" "),t("p",[s._v("如果是通过命令行修改或新增 ACL 权限，需要将其持久化到配置文件中，否则在重启 Redis 服务后，这些 ACL 权限就会丢失")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果使用的是 aclfile 方式，将 ACL 权限持久化到磁盘的 aclfile 中")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl save\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果使用的是 conf 方式，将 ACL 权限持久化到 redis.conf 中")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" config rewrite\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"查看命令类别-用于授权"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看命令类别-用于授权"}},[s._v("#")]),s._v(" 查看命令类别，用于授权")]),s._v(" "),t("p",[s._v("命令类别的出现就是为了方便我们定义用户权限。因为如果通过一个接一个地指定所有命令来设置用户 ACL 确实很烦人，所以我们这样做：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过 +@all 和 -@dangerous，我们包含了所有命令，然后在 Redis 命令表中删除了所有标记为危险的命令")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl setuser zhangsan on +@all -@dangerous "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". ~*\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("那么有哪些命令类别可供选择呢？可以用如下命令进行查看：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# acl cat 显示所有的命令类别")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"keyspace"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"read"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"write"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"set"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sortedset"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hash"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"string"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bitmap"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hyperloglog"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"geo"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stream"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pubsub"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fast"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"slow"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"blocking"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dangerous"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"connection"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"transaction"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"scripting"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("p",[s._v("每一个命令类别具体包含了哪些命令呢？可以用如下命令进行查看：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# acl cat <category> 显示指定类别下的所有命令")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" list\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rpushx"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lrange"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lindex"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"blpop"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lpop"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"brpoplpush"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lset"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rpoplpush"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lpos"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lrem"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lpushx"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"llen"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"blmove"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"brpop"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sort"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rpop"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ltrim"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sort_ro"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rpush"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"blmpop"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lmove"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lmpop"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lpush"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linsert"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("h3",{attrs:{id:"其他常用-acl-命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#其他常用-acl-命令"}},[s._v("#")]),s._v(" 其他常用 ACL 命令")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 ACL 安全日志")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl log\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 help 文档")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" acl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h2",{attrs:{id:"acl-规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#acl-规则"}},[s._v("#")]),s._v(" ACL 规则")]),s._v(" "),t("p",[s._v("前面大量介绍了 ACL 的一些命令，ACL 是使用 DSL（Domain specific language）定义的，一个 DSL 中最核心也是最难记忆的就是规则的写法")]),s._v(" "),t("p",[s._v("以下是整理的一些 ACL 规则的列表，某些规则只是一个单词，用于激活或删除标志或对用户 ACL 执行更改。其他规则是与命令或类别名称、键模式等、关联的字符前缀")]),s._v(" "),t("h3",{attrs:{id:"启用和禁用用户"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启用和禁用用户"}},[s._v("#")]),s._v(" 启用和禁用用户")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("on")]),s._v("：启用用户，可以以该用户身份进行认证")]),s._v(" "),t("li",[t("code",[s._v("off")]),s._v("：禁用用户，不再可以使用此用户进行身份验证，但是已经通过身份验证的连接仍然可以使用")])]),s._v(" "),t("h3",{attrs:{id:"允许和禁止调用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#允许和禁止调用命令"}},[s._v("#")]),s._v(" 允许和禁止调用命令")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("+<command>")]),s._v("：将命令添加到用户可以调用的命令列表中")]),s._v(" "),t("li",[t("code",[s._v("-<command>")]),s._v("：将命令从用户可以调用的命令列表中移除")]),s._v(" "),t("li",[t("code",[s._v("+@<category>")]),s._v("：允许用户调用 "),t("code",[s._v("<category>")]),s._v(" 类别中的所有命令，有效类别为 "),t("code",[s._v("@admin")]),s._v("，"),t("code",[s._v("@set")]),s._v("，"),t("code",[s._v("@sortedset")]),s._v(" 等，可通过调用 "),t("a",{attrs:{href:"https://redis.io/commands/acl-cat/",target:"_blank",rel:"noopener noreferrer"}},[t("code",[s._v("ACL CAT")]),t("OutboundLink")],1),s._v(" 命令查看完整列表。特殊类别 "),t("code",[s._v("@all")]),s._v(" 表示所有命令，包括当前和未来版本中存在的所有命令")]),s._v(" "),t("li",[t("code",[s._v("-@<category>")]),s._v("：禁止用户调用 "),t("code",[s._v("<category>")]),s._v(" 类别中的所有命令")]),s._v(" "),t("li",[t("code",[s._v("+<command>|subcommand")]),s._v("：允许使用已禁用命令的特定子命令")]),s._v(" "),t("li",[t("code",[s._v("allcommands")]),s._v("："),t("code",[s._v("+@all")]),s._v(" 的别名，包括当前存在的命令以及将来通过模块加载的所有命令")]),s._v(" "),t("li",[t("code",[s._v("nocommands")]),s._v("："),t("code",[s._v("-@all")]),s._v(" 的别名，禁止调用所有命令")])]),s._v(" "),t("h3",{attrs:{id:"允许和禁止访问某些-key"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#允许和禁止访问某些-key"}},[s._v("#")]),s._v(" 允许和禁止访问某些 Key")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("~<pattern>")]),s._v("：添加可以在命令中提及的键模式。例如 "),t("code",[s._v("~*")]),s._v(" 允许所有键")]),s._v(" "),t("li",[t("code",[s._v("allkeys")]),s._v("："),t("code",[s._v("~*")]),s._v(" 的别名")]),s._v(" "),t("li",[t("code",[s._v("resetkeys")]),s._v("：刷新允许的键模式列表。例如 ACL "),t("code",[s._v("~foo:* ~bar:* resetkeys ~objects:*")]),s._v("，将导致客户端只能访问与模式 "),t("code",[s._v("objects:*")]),s._v(" 匹配的键")])]),s._v(" "),t("h3",{attrs:{id:"为用户配置有效密码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为用户配置有效密码"}},[s._v("#")]),s._v(" 为用户配置有效密码")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("><password>")]),s._v("：将此密码添加到用户的有效密码列表中。例如，"),t("code",[s._v(">mypass")]),s._v("将 "),t("code",[s._v("mypass")]),s._v(" 添加到有效密码列表中。该命令会清除用户的 "),t("code",[s._v("nopass")]),s._v(" 标记。每个用户可以有任意数量的有效密码")]),s._v(" "),t("li",[t("code",[s._v("<<password>")]),s._v("：从有效密码列表中删除此密码。若该用户的有效密码列表中没有此密码则会返回错误信息。")]),s._v(" "),t("li",[t("code",[s._v("#<hash>")]),s._v("：将此 SHA-256 哈希值添加到用户的有效密码列表中。该哈希值将与为 ACL 用户输入的密码的哈希值进行比较。允许用户将哈希存储在 users.acl 文件中，而不是存储明文密码。仅接受 SHA-256 哈希值，因为密码哈希必须为 64 个字符且小写的十六进制字符")]),s._v(" "),t("li",[t("code",[s._v("!<hash>")]),s._v("：从有效密码列表中删除该哈希值。当不知道哈希值对应的明文是什么时很有用")]),s._v(" "),t("li",[t("code",[s._v("nopass")]),s._v("：移除该用户已设置的所有密码，并将该用户标记为 "),t("code",[s._v("nopass")]),s._v(" 无密码状态：任何密码都可以登录。"),t("code",[s._v("resetpass")]),s._v(" 命令可以清除 "),t("code",[s._v("nopass")]),s._v(" 这种状态")]),s._v(" "),t("li",[t("code",[s._v("resetpass")]),s._v("：清空该用户的所有密码列表，而且移除 "),t("code",[s._v("nopass")]),s._v(" 状态。"),t("code",[s._v("resetpass")]),s._v(" 之后用户没有关联的密码同时也无法使用无密码登录，因此 "),t("code",[s._v("resetpass")]),s._v(" 之后必须添加密码或改为 "),t("code",[s._v("nopass")]),s._v(" 状态才能正常登录")]),s._v(" "),t("li",[t("code",[s._v("reset")]),s._v("：重置用户状态为初始状态。执行以下操作 "),t("code",[s._v("resetpass")]),s._v("，"),t("code",[s._v("resetkeys")]),s._v("，"),t("code",[s._v("off")]),s._v("，"),t("code",[s._v("-@all")])])]),s._v(" "),t("h2",{attrs:{id:"参考文档"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[s._v("#")]),s._v(" 参考文档")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://redis.io/docs/manual/security/acl/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档 - ACL"),t("OutboundLink")],1)])]),s._v(" "),t("p",[s._v("（完）")])])}),[],!1,null,null,null);a.default=n.exports}}]);