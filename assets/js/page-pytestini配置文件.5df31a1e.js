(window.webpackJsonp=window.webpackJsonp||[]).push([[190],{1243:function(s,t,e){"use strict";e.r(t);var a=e(1),n=Object(a.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"pytest-ini-配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pytest-ini-配置文件"}},[s._v("#")]),s._v(" pytest.ini 配置文件")]),s._v(" "),a("h2",{attrs:{id:"配置文件作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文件作用"}},[s._v("#")]),s._v(" 配置文件作用")]),s._v(" "),a("p",[s._v("Pytest 配置文件可以改变 Pytest 的运行方式，它是一个固定的文件 "),a("code",[s._v("pytest.ini")]),s._v(" 文件，读取配置信息，按指定的方式去运行")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("pytest.ini 位置")]),s._v(" "),a("p",[s._v("只能在根目录下")])]),s._v(" "),a("h2",{attrs:{id:"非-test-文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#非-test-文件"}},[s._v("#")]),s._v(" 非 test 文件")]),s._v(" "),a("p",[s._v("Pytest 里面有些文件是非 test 文件")]),s._v(" "),a("ul",[a("li",[s._v("pytest.ini: Pytest 的主配置文件，可以改变 Pytest 的默认行为")]),s._v(" "),a("li",[s._v("conftest.py: 测试用例的一些 fixture 配置")]),s._v(" "),a("li",[a("code",[s._v("_init_.py")]),s._v(": 识别该文件夹为 Python 的 package 包")]),s._v(" "),a("li",[s._v("tox.ini 与 pytest.ini 类似，用 tox 工具时候才有用")]),s._v(" "),a("li",[s._v("setup.cfg 也是 ini 格式文件，影响 setup.py 的行为")])]),s._v(" "),a("h2",{attrs:{id:"pytest-ini-配置文件-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pytest-ini-配置文件-2"}},[s._v("#")]),s._v(" "),a("code",[s._v("pytest.ini")]),s._v(" 配置文件")]),s._v(" "),a("h3",{attrs:{id:"基本格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本格式"}},[s._v("#")]),s._v(" 基本格式")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[pytest]\n\naddopts = -rsxX\nxfail_strict = true\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"查看-pytest-ini-的设置选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看-pytest-ini-的设置选项"}},[s._v("#")]),s._v(" 查看 "),a("code",[s._v("pytest.ini")]),s._v(" 的设置选项")]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("pytest -h")]),s._v(" 命令，找到下面的内容")]),s._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[s._v("相关设置选项")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v('[pytest] ini-options in the first pytest.ini|tox.ini|setup.cfg file found:\n\n  markers (linelist):   markers for test functions\n  empty_parameter_set_mark (string):\n                        default marker for empty parametersets\n  norecursedirs (args): directory patterns to avoid for recursion\n  testpaths (args):     directories to search for tests when no files or\n                        directories are given in the command line.\n  filterwarnings (linelist):\n                        Each line specifies a pattern for\n                        warnings.filterwarnings. Processed after\n                        -W/--pythonwarnings.\n  usefixtures (args):   list of default fixtures to be used with this\n                        project\n  python_files (args):  glob-style file patterns for Python test module\n                        discovery\n  python_classes (args):\n                        prefixes or glob names for Python test class\n                        discovery\n  python_functions (args):\n                        prefixes or glob names for Python test function and\n                        method discovery\n  disable_test_id_escaping_and_forfeit_all_rights_to_community_support (bool):\n                        disable string escape non-ascii characters, might\n                        cause unwanted side effects(use at your own risk)\n  console_output_style (string):\n                        console output: "classic", or with additional\n                        progress information ("progress" (percentage) |\n                        "count").\n  xfail_strict (bool):  default for the strict parameter of xfail markers\n                        when not given explicitly (default: False)\n  enable_assertion_pass_hook (bool):\n                        Enables the pytest_assertion_pass hook.Make sure to\n                        delete any previously generated pyc cache files.\n  junit_suite_name (string):\n                        Test suite name for JUnit report\n  junit_logging (string):\n                        Write captured log messages to JUnit report: one of\n                        no|log|system-out|system-err|out-err|all\n  junit_log_passing_tests (bool):\n                        Capture log information for passing tests to JUnit\n                        report:\n  junit_duration_report (string):\n                        Duration time to report: one of total|call\n  junit_family (string):\n                        Emit XML for schema: one of legacy|xunit1|xunit2\n  doctest_optionflags (args):\n                        option flags for doctests\n  doctest_encoding (string):\n                        encoding used for doctest files\n  cache_dir (string):   cache directory path.\n  log_level (string):   default value for --log-level\n  log_format (string):  default value for --log-format\n  log_date_format (string):\n                        default value for --log-date-format\n  log_cli (bool):       enable log display during test run (also known as\n                        "live logging").\n  log_cli_level (string):\n                        default value for --log-cli-level\n  log_cli_format (string):\n                        default value for --log-cli-format\n  log_cli_date_format (string):\n                        default value for --log-cli-date-format\n  log_file (string):    default value for --log-file\n  log_file_level (string):\n                        default value for --log-file-level\n  log_file_format (string):\n                        default value for --log-file-format\n  log_file_date_format (string):\n                        default value for --log-file-date-format\n  log_auto_indent (string):\n                        default value for --log-auto-indent\n  pythonpath (paths):   Add paths to sys.path\n  faulthandler_timeout (string):\n                        Dump the traceback of all threads if a test takes\n                        more than TIMEOUT seconds to finish.\n  addopts (args):       extra command line options\n  minversion (string):  minimally required pytest version\n  required_plugins (args):\n                        plugins that must be present for pytest to run\n\nenvironment variables:\n  PYTEST_ADDOPTS           extra command line options\n  PYTEST_PLUGINS           comma-separated plugins to load during startup\n  PYTEST_DISABLE_PLUGIN_AUTOLOAD set to disable plugin auto-loading\n  PYTEST_DEBUG             set to enable debug tracing of pytest\'s internals\n\n\nto see available markers type: pytest --markers\nto see available fixtures type: pytest --fixtures\n(shown according to specified file_or_dir or current dir if not specified; fixtures with leading \'_\' are only shown with the \'-v\' option\n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br")])])]),s._v(" "),a("h2",{attrs:{id:"常用配置项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用配置项"}},[s._v("#")]),s._v(" 常用配置项")]),s._v(" "),a("p",[s._v("介绍下常用的配置项，其他配置项可在参考资料中查阅")]),s._v(" "),a("h3",{attrs:{id:"addopts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#addopts"}},[s._v("#")]),s._v(" addopts")]),s._v(" "),a("p",[s._v("添加命令行参数集")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[pytest]\naddopts = -s -v --maxfail=2 -rf  # exit after 2 failures, report fail info\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("相当于")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[s._v("pytest "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("s "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("v "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("maxfail"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("rf test_hello"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("py\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("设置后之后在 cmd 中只需输入 pytest 就行，很方便")]),s._v(" "),a("h3",{attrs:{id:"testpaths"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#testpaths"}},[s._v("#")]),s._v(" testpaths")]),s._v(" "),a("p",[s._v("设置执行测试用例的目录")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[pytest]\ntestpaths = testing\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("设置后，在根目录下运行 pytest 时，只会从 testing 目录中寻找并执行测试用例")]),s._v(" "),a("p",[s._v("例子：")]),s._v(" "),a("p",[a("img",{attrs:{src:e(710),alt:"pytest"}})]),s._v(" "),a("p",[s._v("可以看到结果中只执行了 "),a("code",[s._v("testing/")]),s._v(" 目录下的测试用例")]),s._v(" "),a("h3",{attrs:{id:"markers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#markers"}},[s._v("#")]),s._v(" markers")]),s._v(" "),a("p",[s._v("指定执行被标记的测试用例")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[pytest]\nmarkers =\n    slow:this is a slow\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("例子：")]),s._v(" "),a("p",[a("img",{attrs:{src:e(711),alt:"pytest"}})]),s._v(" "),a("p",[s._v("可以看到只有被标记的 "),a("code",[s._v("test_04")]),s._v(" 被执行了")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("-m ：参数后要跟上执行的标记名，即在 markers 中设置的")])]),s._v(" "),a("h3",{attrs:{id:"更改测试用例收集规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更改测试用例收集规则"}},[s._v("#")]),s._v(" 更改测试用例收集规则")]),s._v(" "),a("p",[s._v("pytest默认的测试用例收集规则")]),s._v(" "),a("ul",[a("li",[s._v("文件名以 "),a("code",[s._v("test_*.py")]),s._v(" 文件和 "),a("code",[s._v("*_test.py")])]),s._v(" "),a("li",[s._v("以 "),a("code",[s._v("test_")]),s._v(" 开头的函数")]),s._v(" "),a("li",[s._v("以 Test 开头的类，不能包含 "),a("code",[s._v("__init__")]),s._v(" 方法")]),s._v(" "),a("li",[s._v("以 "),a("code",[s._v("test_")]),s._v(" 开头的类里面的方法")])]),s._v(" "),a("p",[s._v("我们是可以修改或者添加这个用例收集规则的，建议在原有的规则上添加的，如下配置")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[pytest] \npython_files = test_*  *_test  test* \npython_classes = Test*   test* \npython_functions = test_*  test*\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"norecursedirs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#norecursedirs"}},[s._v("#")]),s._v(" norecursedirs")]),s._v(" "),a("p",[s._v("Pytest 收集测试用例时，会递归遍历所有子目录，包括某些你明知道没必要遍历的目录，遇到这种情况，可以使用 norecursedirs 参数简化 Pytest 的搜索工作")]),s._v(" "),a("p",[a("strong",[s._v("默认设置")]),s._v("："),a("code",[s._v("norecursedirs = .* build dist CVS _darcs {arch} *.egg")])]),s._v(" "),a("p",[a("strong",[s._v("正确写法")]),s._v("：多个路径用空格隔开")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("[pytest] norecursedirs = .* build dist CVS _darcs {arch} *.egg venv src resources log report util\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://docs.pytest.org/en/latest/reference/customize.html?highlight=ini",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档-Configuration"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("a",{attrs:{href:"https://docs.pytest.org/en/latest/reference/reference.html#ini-options-ref",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档-Configuration Options"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("（完）")])])}),[],!1,null,null,null);t.default=n.exports},710:function(s,t,e){s.exports=e.p+"assets/img/15.3f2da1f9.png"},711:function(s,t,e){s.exports=e.p+"assets/img/16.3f1a4163.png"}}]);