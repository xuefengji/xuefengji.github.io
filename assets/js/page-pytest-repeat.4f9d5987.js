(window.webpackJsonp=window.webpackJsonp||[]).push([[186],{1243:function(t,s,a){"use strict";a.r(s);var e=a(1),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"pytest-repeat"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pytest-repeat"}},[t._v("#")]),t._v(" pytest-repeat")]),t._v(" "),e("p",[t._v("pytest-repeat 是 Pytest 的一个插件，用于重复执行单个用例，或多个测试用例，并指定重复次数")]),t._v(" "),e("h2",{attrs:{id:"环境要求"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#环境要求"}},[t._v("#")]),t._v(" 环境要求")]),t._v(" "),e("ul",[e("li",[t._v("Python 2.7, 3.5+ 或者 PyPy")]),t._v(" "),e("li",[t._v("pytest 3.6 或者更高")])]),t._v(" "),e("h2",{attrs:{id:"安装-pytest-repeat"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装-pytest-repeat"}},[t._v("#")]),t._v(" 安装 pytest-repeat")]),t._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[t._v("pip install pytest"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("repeat\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("h2",{attrs:{id:"pytest-repeat-使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pytest-repeat-使用"}},[t._v("#")]),t._v(" pytest-repeat 使用")]),t._v(" "),e("p",[t._v("有两种方式：")]),t._v(" "),e("ul",[e("li",[t._v("命令行模式")]),t._v(" "),e("li",[t._v("装饰器模式")])]),t._v(" "),e("h3",{attrs:{id:"命令行模式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#命令行模式"}},[t._v("#")]),t._v(" 命令行模式")]),t._v(" "),e("p",[t._v("使用 "),e("code",[t._v("--count")]),t._v(" 参数指定要重复几次")]),t._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[t._v("pytest "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("count"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(" test_file"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("py\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br")])]),e("p",[t._v("使用上面的命令是每个用例会被重复执行，但有时候希望按 "),e("code",[t._v("test_1,test_2")]),t._v(" 这样执行的顺序重复执行\n"),e("code",[t._v("--repeat-scope")]),t._v(" 就是用来解决这个问题的")]),t._v(" "),e("h4",{attrs:{id:"repeat-scope"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#repeat-scope"}},[t._v("#")]),t._v(" --repeat-scope")]),t._v(" "),e("p",[t._v("作用：类似于 fixture 的 scope 参数，可以覆盖默认的测试用例执行顺序")]),t._v(" "),e("p",[e("code",[t._v("--scope")]),t._v(" 参数：")]),t._v(" "),e("ul",[e("li",[t._v("function：默认，范围针对每个用例重复执行，再执行下一个用例")]),t._v(" "),e("li",[t._v("class：以 class 为用例集合单位，重复执行 class 里面的用例，再执行下一个")]),t._v(" "),e("li",[t._v("module：以模块为单位，重复执行模块里面的用例，再执行下一个")]),t._v(" "),e("li",[t._v("session：重复整个测试会话，即所有测试用例的执行一次，然后再执行第二次")])]),t._v(" "),e("h5",{attrs:{id:"示例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#示例"}},[t._v("#")]),t._v(" 示例")]),t._v(" "),e("h6",{attrs:{id:"repeat-scope-module"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#repeat-scope-module"}},[t._v("#")]),t._v(" --repeat-scope=module")]),t._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("test_repeat1")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"测试用例执行111"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("test_repeat2")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"测试用例执行222"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Test_repeat")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("test_repeat3")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("self"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"测试用例执行333"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br")])]),e("p",[t._v("执行结果：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("test_repeat.py::test_repeat1[1-2] 测试用例执行111\nPASSED\ntest_repeat.py::test_repeat2[1-2] 测试用例执行222\nPASSED\ntest_repeat.py::Test_repeat::test_repeat3[1-2] 测试用例执行333\nPASSED\ntest_repeat.py::test_repeat1[2-2] 测试用例执行111\nPASSED\ntest_repeat.py::test_repeat2[2-2] 测试用例执行222\nPASSED\ntest_repeat.py::Test_repeat::test_repeat3[2-2] 测试用例执行333\nPASSED\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br"),e("span",{staticClass:"line-number"},[t._v("11")]),e("br"),e("span",{staticClass:"line-number"},[t._v("12")]),e("br")])]),e("h4",{attrs:{id:"重复测试直到失败"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重复测试直到失败"}},[t._v("#")]),t._v(" 重复测试直到失败")]),t._v(" "),e("ul",[e("li",[t._v("如果需要验证偶现问题，可以一次又一次地运行相同的测试直到失败，这个插件将很有用")]),t._v(" "),e("li",[t._v("可以将 pytest 的 "),e("code",[t._v("-x")]),t._v(" 选项与 "),e("code",[t._v("pytest-repeat")]),t._v(" 结合使用，以强制测试运行程序在第一次失败时停止")])]),t._v(" "),e("p",[t._v("例如：")]),t._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("test_example")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" random\n    flag "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" random"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("choice"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("True")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("flag"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("assert")]),t._v(" flag\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br")])]),e("p",[t._v("执行命令："),e("code",[t._v("pytest -s --count 5 -x test_repeat.py")])]),t._v(" "),e("p",[t._v("执行结果：")]),t._v(" "),e("p",[e("img",{attrs:{src:a(711),alt:"pytest"}})]),t._v(" "),e("h3",{attrs:{id:"装饰器模式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#装饰器模式"}},[t._v("#")]),t._v(" 装饰器模式")]),t._v(" "),e("p",[t._v("使用 "),e("code",[t._v("@pytest.mark.repeat(count)")]),t._v(" 可以将代码中某些测试用例标记为重复执行")]),t._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@pytest"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mark"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("repeat")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("test_repeat")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("print")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v('"测试用例执行"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br")])]),e("p",[t._v("执行命令："),e("code",[t._v("pytest -s -v test_repeat.py")])]),t._v(" "),e("p",[t._v("执行结果：")]),t._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("test_repeat.py::test_repeat[1-5] 测试用例执行\nPASSED\ntest_repeat.py::test_repeat[2-5] 测试用例执行\nPASSED\ntest_repeat.py::test_repeat[3-5] 测试用例执行\nPASSED\ntest_repeat.py::test_repeat[4-5] 测试用例执行\nPASSED\ntest_repeat.py::test_repeat[5-5] 测试用例执行\nPASSED\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br")])]),e("h2",{attrs:{id:"参考资料"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),e("p",[e("a",{attrs:{href:"https://github.com/pytest-dev/pytest-repeat/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档：pytest-repeat"),e("OutboundLink")],1)]),t._v(" "),e("p",[t._v("（完）")])])}),[],!1,null,null,null);s.default=n.exports},711:function(t,s,a){t.exports=a.p+"assets/img/36.fb557ed2.png"}}]);