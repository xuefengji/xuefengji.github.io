(window.webpackJsonp=window.webpackJsonp||[]).push([[148],{1232:function(s,t,a){"use strict";a.r(t);var e=a(1),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"assert-断言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#assert-断言"}},[s._v("#")]),s._v(" assert 断言")]),s._v(" "),e("h2",{attrs:{id:"前言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),e("p",[s._v("回顾下 Unittest 的断言：")]),s._v(" "),e("ul",[e("li",[s._v("assertIn（expect，result）断言包含（被包含的写前面）")]),s._v(" "),e("li",[s._v("assertEqual（expect，result）断言相等")]),s._v(" "),e("li",[s._v("assertTure（条件）断言是否为真。返回 Ture 或 False")])]),s._v(" "),e("p",[s._v("Pytest 与 Unittest 不同，直接使用 Python 中 "),e("strong",[s._v("assert")]),s._v(" 关键字进行断言，关键字可接表达式，表达式值为 true 则通过，否则失败")]),s._v(" "),e("h2",{attrs:{id:"常用断言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常用断言"}},[s._v("#")]),s._v(" 常用断言")]),s._v(" "),e("ul",[e("li",[s._v("assert xx：判断 xx 为真")]),s._v(" "),e("li",[s._v("assert not xx：判断 xx 不为真")]),s._v(" "),e("li",[s._v("assert a in b：判断 b 包含 a")]),s._v(" "),e("li",[s._v("assert a == b：判断 a 等于 b")]),s._v(" "),e("li",[s._v("assert a !=b：判断 a 不等于 b")])]),s._v(" "),e("h3",{attrs:{id:"实例"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实例"}},[s._v("#")]),s._v(" 实例")]),s._v(" "),e("p",[s._v("想在异常的时候，输出一些提示信息，这样报错后，就方便查看是什么原因了")]),s._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("f")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("test_function")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    a "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" f"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("assert")]),s._v(" a "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"判断 a 为偶数，当前 a 的值为：%s"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v("a\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("结果：")]),s._v(" "),e("p",[e("img",{attrs:{src:a(683),alt:"pytest"}})]),s._v(" "),e("h2",{attrs:{id:"异常断言"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#异常断言"}},[s._v("#")]),s._v(" 异常断言")]),s._v(" "),e("p",[s._v("可以使用 pytest.raises 作为上下文管理器，当抛出异常时可以获取到对应的异常实例")]),s._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("test_zero_division")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" pytest"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("raises"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ZeroDivisionError"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("assert")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("eval")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1+2"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("结果：")]),s._v(" "),e("p",[e("img",{attrs:{src:a(684),alt:"pytest"}})]),s._v(" "),e("p",[s._v("可以看到 raises 捕获了异常，并继续下面断言代码")]),s._v(" "),e("div",{staticClass:"custom-block tip"},[e("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),e("p",[s._v("使用 "),e("code",[s._v("pytest.raises")]),s._v(" 作为上下文管理器，是上下文管理器范围内的最后一行\n后面在上下文管理器范围内的代码行将不会被执行")])]),s._v(" "),e("p",[s._v("在捕获异常后，可以从上下文管理器中获取异常的一些详细信息，可以辅助我们更好的去断言")]),s._v(" "),e("h3",{attrs:{id:"实例-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实例-2"}},[s._v("#")]),s._v(" 实例")]),s._v(" "),e("p",[e("strong",[s._v("断言场景")]),s._v("：断言它抛的异常是不是预期想要的")]),s._v(" "),e("p",[e("strong",[s._v("代码执行")]),s._v("：1/0")]),s._v(" "),e("p",[e("strong",[s._v("预期结果")]),s._v("：抛的异常是 "),e("code",[s._v("ZeroDivisionError: division by zero")])]),s._v(" "),e("p",[e("strong",[s._v("如何断言")]),s._v("：通常是断言异常的 type 和 value 值了")]),s._v(" "),e("p",[e("strong",[s._v("具体方式")]),s._v("：这里 1/0 的异常类型是 ZeroDivisionError，异常的 value 值是 "),e("code",[s._v("division by zero")])]),s._v(" "),e("div",{staticClass:"language-python line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-python"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("test_zero_division")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[s._v("'''断言异常'''")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" pytest"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("raises"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ZeroDivisionError"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" excinfo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 断言异常类型type")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("assert")]),s._v(" excinfo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("type")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" ZeroDivisionError\n    "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 断言异常value值")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("assert")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"division by zero"')]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("str")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("excinfo"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("value"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("excinfo ：是一个异常信息实例")]),s._v(" "),e("p",[e("strong",[s._v("主要属性")]),s._v("："),e("code",[s._v(".type")]),s._v(" 、"),e("code",[s._v(".value")]),s._v(" 、"),e("code",[s._v(".traceback")])]),s._v(" "),e("p",[e("strong",[s._v("注意")]),s._v("：断言 type 的时候，异常类型是不需要加引号的，断言 value 值的时候需转 str")]),s._v(" "),e("h3",{attrs:{id:"match-参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#match-参数"}},[s._v("#")]),s._v(" match 参数")]),s._v(" "),e("p",[s._v("可以将 match 关键字参数传递给上下文管理器，以测试正则表达式与异常的字符串表示形式是否匹配")]),s._v(" "),e("p",[e("strong",[s._v("注意")]),s._v("：这种方法只能断言 value，不能断言 type")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('# 自定义消息\ndef myfunc():\n    raise ValueError("Exception 123 raised")\n\ndef test_match():\n    with pytest.raises(ValueError, match=r".* 123 .*"):\n        myfunc()\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("该 match 方法的 regexp 参数与 "),e("code",[s._v("re.search")]),s._v(" 函数匹配，因此在上面的示例中 "),e("code",[s._v("match='123'")]),s._v(" 也可以使用")]),s._v(" "),e("h3",{attrs:{id:"检查断言装饰器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#检查断言装饰器"}},[s._v("#")]),s._v(" 检查断言装饰器")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("@pytest.mark.xfail(raises=ZeroDivisionError)\ndef test_f():\n    1 / 0\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[e("img",{attrs:{src:a(685),alt:"pytest"}})]),s._v(" "),e("div",{staticClass:"custom-block warning"},[e("p",{staticClass:"custom-block-title"},[s._v("总结")]),s._v(" "),e("ul",[e("li",[s._v("代码抛出异常，但是和 raises 指定的异常类相匹配，所以不会断言失败")]),s._v(" "),e("li",[s._v("它相当于一个检查异常装饰器，功能：检查是否有异常，不确定是否有异常")]),s._v(" "),e("li",[e("code",[s._v("with pytest.raise(ZeroDivisionError)")]),s._v(" 对于故意测试异常代码的情况，使用可能会更好")]),s._v(" "),e("li",[s._v("而 "),e("code",[s._v("@pytest.mark.xfail(raises=ZeroDivisionError)")]),s._v(" 对于检查未修复的错误（即，可能会发生异常），使用检查断言可能会更好")])])]),s._v(" "),e("h2",{attrs:{id:"参考资料"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://docs.pytest.org/en/latest/how-to/assert.html#assertraises",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("（完）")])])}),[],!1,null,null,null);t.default=n.exports},683:function(s,t,a){s.exports=a.p+"assets/img/7.70663bd5.png"},684:function(s,t,a){s.exports=a.p+"assets/img/8.9cb0e087.png"},685:function(s,t,a){s.exports=a.p+"assets/img/9.d8528658.png"}}]);