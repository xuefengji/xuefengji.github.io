(window.webpackJsonp=window.webpackJsonp||[]).push([[116],{1164:function(s,a,e){"use strict";e.r(a);var t=e(1),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"redis-主从复制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-主从复制"}},[s._v("#")]),s._v(" Redis 主从复制")]),s._v(" "),t("h2",{attrs:{id:"什么是主从复制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是主从复制"}},[s._v("#")]),s._v(" 什么是主从复制")]),s._v(" "),t("ul",[t("li",[s._v("将一台 Redis 服务器的数据，复制到其他 Redis 服务器")]),s._v(" "),t("li",[s._v("前者称为主节点，后者称为从节点")]),s._v(" "),t("li",[t("strong",[s._v("数据的复制是单向的，只能由主节点复制到从节点")])]),s._v(" "),t("li",[s._v("主节点以写为主，从节点以读为主")])]),s._v(" "),t("h2",{attrs:{id:"主从复制的作用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主从复制的作用"}},[s._v("#")]),s._v(" 主从复制的作用")]),s._v(" "),t("ul",[t("li",[s._v("数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据冗余的方式")]),s._v(" "),t("li",[s._v("故障恢复：当主节点故障时，从节点可以暂时替代主节点提供服务，是一种服务冗余的方式")]),s._v(" "),t("li",[s._v("负载均衡：在主从复制的基础上，配合读写分离，由主节点进行写操作，从节点进行读操作，分担服务器的负载；尤其是在多读少写的场景下，通过多个从节点分担负载，提高并发量")]),s._v(" "),t("li",[s._v("高可用基石：主从复制还是哨兵和集群能够实施的基础")])]),s._v(" "),t("h2",{attrs:{id:"为什么要使用集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么要使用集群"}},[s._v("#")]),s._v(" 为什么要使用集群")]),s._v(" "),t("ul",[t("li",[s._v("单台服务器难以负载大量的请求")]),s._v(" "),t("li",[s._v("单台服务器故障率高，系统崩坏概率大")]),s._v(" "),t("li",[s._v("单台服务器内存容量有限")])]),s._v(" "),t("h2",{attrs:{id:"集群环境配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#集群环境配置"}},[s._v("#")]),s._v(" 集群环境配置")]),s._v(" "),t("p",[s._v("主要实现的是单机多服务集群")]),s._v(" "),t("h3",{attrs:{id:"以命令的形式配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#以命令的形式配置"}},[s._v("#")]),s._v(" 以命令的形式配置")]),s._v(" "),t("p",[s._v("查看当前库的信息：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" info replication\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Replication")]),s._v("\nrole:master             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 角色")]),s._v("\nconnected_slaves:0      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从机数量")]),s._v("\nmaster_failover_state:no-failover\nmaster_replid:053d096358fe090b7c3ec8616e4ae90402ccd42d\nmaster_replid2:0000000000000000000000000000000000000000\nmaster_repl_offset:0\nsecond_repl_offset:-1\nrepl_backlog_active:0\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:0\nrepl_backlog_histlen:0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("h4",{attrs:{id:"一主二从配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#一主二从配置"}},[s._v("#")]),s._v(" 一主二从配置")]),s._v(" "),t("p",[t("strong",[s._v("第一步")]),s._v("：")]),s._v(" "),t("ul",[t("li",[s._v("需要启动多个服务，就需要多个配置文件")]),s._v(" "),t("li",[s._v("每个配置文件对应修改以下信息\n"),t("ul",[t("li",[s._v("端口号")]),s._v(" "),t("li",[s._v("pid 文件名")]),s._v(" "),t("li",[s._v("日志文件名")]),s._v(" "),t("li",[s._v("rdb 文件名")])])])]),s._v(" "),t("p",[s._v("启动单机多服务集群，查看进程：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@test redis-config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ps -ef|grep redis")]),s._v("\nroot     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30315")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":24 ?        00:00:00 redis-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6379\nroot     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30321")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":24 ?        00:00:00 redis-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6380\nroot     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30328")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":25 ?        00:00:00 redis-server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:6381\nroot     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30335")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30283")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":25 pts/5    00:00:00 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" redis\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[t("strong",[s._v("第二步")]),s._v("：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("默认情况下，每台 Redis 服务都是主节点")])]),s._v(" "),t("li",[t("p",[s._v("使用 "),t("code",[s._v("slaveof host post")]),s._v(" 配置从机")])])]),s._v(" "),t("p",[s._v("将 80、81 配置为从机")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("----------------------------80---------------------------------\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:638"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" SLAVEOF "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:638"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" info replication\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Replication")]),s._v("\nrole:slave                                "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 变成从机了")]),s._v("\nmaster_host:127.0.0.1\nmaster_port:6379\nmaster_link_status:up\nmaster_last_io_seconds_ago:4\nmaster_sync_in_progress:0\nslave_read_repl_offset:42\nslave_repl_offset:42\nslave_priority:100\nslave_read_only:1\nreplica_announced:1\nconnected_slaves:0\nmaster_failover_state:no-failover\nmaster_replid:727048f272ec1e7bff9d178bdd2b97a8c37eb6cf\nmaster_replid2:0000000000000000000000000000000000000000\nmaster_repl_offset:42\nsecond_repl_offset:-1\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:15\nrepl_backlog_histlen:28\n\n----------------------------81---------------------------------\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:638"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v(" SLAVEOF "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.2 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:638"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v(" info replication\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Replication")]),s._v("\nrole:slave                              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 变成从机了")]),s._v("\nmaster_host:127.0.0.1\nmaster_port:6379\nmaster_link_status:down\nmaster_last_io_seconds_ago:-1\nmaster_sync_in_progress:0\nslave_read_repl_offset:0\nslave_repl_offset:0\nmaster_link_down_since_seconds:-1\nslave_priority:100\nslave_read_only:1\nreplica_announced:1\nconnected_slaves:0\nmaster_failover_state:no-failover\nmaster_replid:ae95e721f4791b7b7dc28df51329f44e24f5533d\nmaster_replid2:0000000000000000000000000000000000000000\nmaster_repl_offset:0\nsecond_repl_offset:-1\nrepl_backlog_active:0\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:0\nrepl_backlog_histlen:0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br")])]),t("p",[s._v("主机上查看：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" info replication\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Replication")]),s._v("\nrole:master\nconnected_slaves:2                      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 有 2 个从机")]),s._v("\nslave0:ip"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1,port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6380")]),s._v(",state"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("online,offset"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("350")]),s._v(",lag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nslave1:ip"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1,port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6381")]),s._v(",state"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("online,offset"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("350")]),s._v(",lag"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nmaster_failover_state:no-failover\nmaster_replid:727048f272ec1e7bff9d178bdd2b97a8c37eb6cf\nmaster_replid2:0000000000000000000000000000000000000000\nmaster_repl_offset:350\nsecond_repl_offset:-1\nrepl_backlog_active:1\nrepl_backlog_size:1048576\nrepl_backlog_first_byte_offset:1\nrepl_backlog_histlen:350\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("h4",{attrs:{id:"使用规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用规则"}},[s._v("#")]),s._v(" 使用规则")]),s._v(" "),t("ul",[t("li",[s._v("从机只能读，不能写，主机可读可写，一般主机主要用于写")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("----------------------------主机79-------------------------------\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" k1 v1\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" k2 v2\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" get k2\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v2"')]),s._v("\n----------------------------从机80-------------------------------\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:638"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" k3 v3\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("error"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" READONLY You can"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'t write against a read only replica.    # 写入失败\n127.0.0.1:6380> get k2\n\"v2\"\n----------------------------从机81-------------------------------\n127.0.0.1:6381> set k4 v4\n(error) READONLY You can'")]),s._v("t "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("write")]),s._v(" against a "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" only replica.   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 写入失败")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:638"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v(" get k2\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v2"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("ul",[t("li",[s._v("当主机断电宕机后，默认情况下从机的角色不会发生变化 ，集群中只是失去了写操作，当主机恢复以后，又会连接上从机恢复原状")]),s._v(" "),t("li",[s._v("当从机断电宕机后，若不是使用配置文件配置的从机，再次启动后会作为主机，无法获取之前主机的数据的，若此时重新配置称为从机，又可以获取到主机的所有数据")]),s._v(" "),t("li",[s._v("第二条中提到，默认情况下，主机故障后，不会出现新的主机，有两种方式可以产生新的主机：\n"),t("ul",[t("li",[s._v("从机手动执行命令 "),t("code",[s._v("slaveof no one")]),s._v("，这样执行以后从机会独立出来成为一个主机")]),s._v(" "),t("li",[s._v("使用哨兵模式（自动选举）")])])])]),s._v(" "),t("h3",{attrs:{id:"以配置文件形式配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#以配置文件形式配置"}},[s._v("#")]),s._v(" 以配置文件形式配置")]),s._v(" "),t("p",[s._v("上面是以命令的形式进行配置的，这种是短暂的")]),s._v(" "),t("p",[s._v("如果要进行永久配置，是需要修改配置文件的")]),s._v(" "),t("p",[t("img",{attrs:{src:e(617),alt:"master"}})]),s._v(" "),t("h2",{attrs:{id:"主从复制原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#主从复制原理"}},[s._v("#")]),s._v(" 主从复制原理")]),s._v(" "),t("ul",[t("li",[s._v("slave 启动成功连接到 master 后会发送一个 sync 同步命令")]),s._v(" "),t("li",[s._v("master 接到指令，启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令")]),s._v(" "),t("li",[s._v("在后台进程执行完毕后，master 将传送整个数据文件到 slave，并完成一次同步")])]),s._v(" "),t("p",[t("strong",[s._v("全量复制")]),s._v("：slave 服务在接收到数据库文件数据后，将其存盘并加载到内存")]),s._v(" "),t("p",[t("strong",[s._v("增量复制")]),s._v("：master 继续将新的所有收集到的修改命令依次传给 slave，完成同步")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("总结")]),s._v(" "),t("p",[s._v("slave 在第一次启动时，实行的是全量复制，后续是增量复制")])]),s._v(" "),t("p",[s._v("（完）")])])}),[],!1,null,null,null);a.default=n.exports},617:function(s,a,e){s.exports=e.p+"assets/img/ms1.671956a7.png"}}]);