(window.webpackJsonp=window.webpackJsonp||[]).push([[170],{1017:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"docker-网络"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker-网络"}},[s._v("#")]),s._v(" docker 网络")]),s._v(" "),n("h2",{attrs:{id:"网络类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#网络类型"}},[s._v("#")]),s._v(" 网络类型")]),s._v(" "),n("p",[n("img",{attrs:{src:a(448),alt:"网络模式"}})]),s._v(" "),n("ul",[n("li",[n("p",[s._v("Bridge (默认模式)")]),s._v(" "),n("ul",[n("li",[s._v("host 与容器中的服务通过 Bridge 连接")]),s._v(" "),n("li",[s._v("容器有自己的 IP 地址")]),s._v(" "),n("li",[s._v("在 Bridge 模式下，需要使用到端口映射")])])]),s._v(" "),n("li",[n("p",[s._v("Host")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("host 与服务器中的服务直接连接")])]),s._v(" "),n("li",[n("p",[s._v("容器与 host 在同一局域网类")])])])]),s._v(" "),n("li",[n("p",[s._v("None")]),s._v(" "),n("p",[s._v("无网络模式")])])]),s._v(" "),n("h2",{attrs:{id:"理解-docker0"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#理解-docker0"}},[s._v("#")]),s._v(" 理解 docker0")]),s._v(" "),n("p",[s._v("先使用 "),n("code",[s._v("ip addr")]),s._v(" 查看下地址情况")]),s._v(" "),n("p",[n("img",{attrs:{src:a(449),alt:"docker"}})]),s._v(" "),n("p",[s._v("那 docker 是如何处理容器网络访问的？")]),s._v(" "),n("p",[s._v("先运行一个 tomcat 容器")]),s._v(" "),n("div",{staticClass:"language-shell script line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 运行容器")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -P --name tomcat01 tomcat\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 ip")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" inspect  tomcat01\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("结果：")]),s._v(" "),n("div",{staticClass:"language-shell script line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Networks"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bridge"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPAMConfig"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Links"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Aliases"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null,\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NetworkID"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1a34c6878d70eff9c776795be79d3af53d90d02387738ce9cdecc9f7a7628a12"')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"EndpointID"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"e945b60a33d589ea48e113b3667729469c2d798f724dcbf4fecb2511554f9b98"')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Gateway"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123.12.0.1"')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123.12.0.2"')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPPrefixLen"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"IPv6Gateway"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GlobalIPv6Address"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GlobalIPv6PrefixLen"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MacAddress"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"02:42:xx:11:xx:02"')]),s._v(",\n                    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DriverOpts"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" null\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("上面结果中发现：")]),s._v(" "),n("ul",[n("li",[s._v("容器的地址与 docker0 的地址在同一网段")]),s._v(" "),n("li",[s._v("容器的网关设置为 docker0 的地址")])]),s._v(" "),n("p",[s._v("再次在 Linux 上查看 ip")]),s._v(" "),n("div",{staticClass:"language-shell script line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-16-7-centos ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ip addr")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(": lo: "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("LOOPBACK,UP,LOWER_UP"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v(" qdisc noqueue state UNKNOWN group default qlen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00\n    inet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1/8 scope "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" lo\n       valid_lft forever preferred_lft forever\n    inet6 ::1/128 scope "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" \n       valid_lft forever preferred_lft forever\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": eth0: "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,UP,LOWER_UP"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc mq state UP group default qlen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    link/ether "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("52")]),s._v(":54:00:23:33:ec brd ff:ff:ff:ff:ff:ff\n    inet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.0")]),s._v(".16.7/22 brd "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".19.255 scope global eth0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::5054:ff:fe23:33ec/64 scope "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" \n       valid_lft forever preferred_lft forever\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(": docker0: "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,UP,LOWER_UP"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc noqueue state UP group default \n    link/ether 02:42:f8:a5:25:5b brd ff:ff:ff:ff:ff:ff\n    inet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.17")]),s._v(".0.1/16 brd "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.17")]),s._v(".255.255 scope global docker0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::42:f8ff:fea5:255b/64 scope "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" \n       valid_lft forever preferred_lft forever\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("119")]),s._v(": veth705ec28@if118: "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("BROADCAST,MULTICAST,UP,LOWER_UP"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" mtu "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1500")]),s._v(" qdisc noqueue master docker0 state UP group default \n    link/ether 0e:91:3d:df:ad:20 brd ff:ff:ff:ff:ff:ff link-netnsid "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    inet6 fe80::c91:3dff:fedf:ad20/64 scope "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" \n       valid_lft forever preferred_lft forever\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("ul",[n("li",[s._v("可以看到则增加了一个接口 119：veth705ec28@if118，此接口为 tomcat01 容器的接口")]),s._v(" "),n("li",[s._v("接口是成对出现的，这是因为使用了 evth-pair 技术")]),s._v(" "),n("li",[s._v("evth-pair 技术充当桥梁，连接各种虚拟网络设备")])]),s._v(" "),n("p",[s._v("在 Linux 上使用 ping 命令测试 Linux 与 容器之间是否连通:")]),s._v(" "),n("div",{staticClass:"language-shell script line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-16-7-centos ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ping 123.17.0.2")]),s._v("\nPING "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.17")]),s._v(".0.2 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.17")]),s._v(".0.2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" bytes of data.\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.17")]),s._v(".0.2: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.039")]),s._v(" ms\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" bytes from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("123.17")]),s._v(".0.2: "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("icmp_seq")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.036")]),s._v(" ms\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[s._v("发现是可以测试成功的")]),s._v(" "),n("p",[s._v("再启动一个 tomcat02 时，tomcat01 和 tomcat02 是可以相互 ping 通的")]),s._v(" "),n("p",[n("strong",[s._v("容器网络访问（重点）")]),s._v("：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(450),alt:"docker"}})]),s._v(" "),n("div",{staticClass:"custom-block danger"},[n("p",{staticClass:"custom-block-title"},[s._v("总结：")]),s._v(" "),n("ul",[n("li",[s._v("Docker 使用 Linux 桥接")]),s._v(" "),n("li",[s._v("Dcoker 中所有的网络接口都是虚拟的，内网转发效率高")]),s._v(" "),n("li",[s._v("Docker 会给容器分配一个可用的 IP")]),s._v(" "),n("li",[s._v("默认不指定网络的情况下，所有的容器共用一个路由 docker0")]),s._v(" "),n("li",[s._v("删除容器，对应的一对网桥就没了")])])]),s._v(" "),n("p",[n("strong",[s._v("核心原理图")]),s._v("：")]),s._v(" "),n("p",[n("img",{attrs:{src:a(451),alt:"docker"}})]),s._v(" "),n("p",[s._v("（完）")])])}),[],!1,null,null,null);t.default=e.exports},448:function(s,t,a){s.exports=a.p+"assets/img/网络模式.c544ec77.jpg"},449:function(s,t,a){s.exports=a.p+"assets/img/net1.27dbc827.png"},450:function(s,t,a){s.exports=a.p+"assets/img/net2.7753d1da.png"},451:function(s,t,a){s.exports=a.p+"assets/img/net3.17a76e6b.png"}}]);