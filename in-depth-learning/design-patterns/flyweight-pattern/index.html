<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>享元模式 | 前端修炼小册</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/favicon.png">
    <link rel="stylesheet" href="/css/style.css">
    <script charset="utf-8" src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script charset="utf-8" src="/js/main.js"></script>
    <link rel="alternate" type="application/atom+xml" href="https://www.fedbook.cn/atom.xml" title="前端修炼小册 Atom Feed">
    <link rel="alternate" type="application/json" href="https://www.fedbook.cn/feed.json" title="前端修炼小册 JSON Feed">
    <link rel="alternate" type="application/rss+xml" href="https://www.fedbook.cn/rss.xml" title="前端修炼小册 RSS Feed">
    <meta name="description" content="Wenyuan&#39;s Front-End Development Book">
    <meta property="og:url" content="/in-depth-learning/design-patterns/flyweight-pattern.html">
    <meta property="og:site_name" content="前端修炼小册">
    <meta property="og:title" content="享元模式">
    <meta property="og:description" content="享元模式 介绍 享元模式（Flyweight Pattern）运用共享技术来有效地支持大量细粒度对象的复用，以减少创建的对象的数量。 享元模式的主要思想是共享细粒度对象，也就是说如果系统中存在多个相同的对象，那么只需共享一份就可以了，不必每个都去实例化每一个对象，这样来精简内存资源，提升性能和效率。 简单来说， 共享内存（主要考虑内存，而非效率）; 相同的数">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh-CN">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="前端修炼小册">
    <meta property="article:author" content="wenyuan">
    
    <link rel="preload" href="/assets/css/0.styles.ccbf91ab.css" as="style"><link rel="preload" href="/assets/js/app.34fc3e13.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.a3786f42.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.a77e3a6c.js" as="script"><link rel="preload" href="/assets/js/page-享元模式.b25964f3.js" as="script"><link rel="prefetch" href="/assets/js/layout-Blog.2136fbb1.js"><link rel="prefetch" href="/assets/js/layout-Layout.f12fcd54.js"><link rel="prefetch" href="/assets/js/layout-NotFound.3d8a7c0c.js"><link rel="prefetch" href="/assets/js/page-Arrayprototypeincludes().f5cfd5d0.js"><link rel="prefetch" href="/assets/js/page-Array扩展.6f58cbca.js"><link rel="prefetch" href="/assets/js/page-BFC.6c7e28ff.js"><link rel="prefetch" href="/assets/js/page-BigInt.69165cbc.js"><link rel="prefetch" href="/assets/js/page-B端产品文案指南.fa81d4ab.js"><link rel="prefetch" href="/assets/js/page-CSRF攻击.cde338ce.js"><link rel="prefetch" href="/assets/js/page-CSS.60568dc5.js"><link rel="prefetch" href="/assets/js/page-CSS引入方式.3841259e.js"><link rel="prefetch" href="/assets/js/page-CSS规范.a487fd32.js"><link rel="prefetch" href="/assets/js/page-CSS问题.c233a050.js"><link rel="prefetch" href="/assets/js/page-Class.137ead68.js"><link rel="prefetch" href="/assets/js/page-CodeReview.9dc2b37d.js"><link rel="prefetch" href="/assets/js/page-ES6-ES12新特性.5e281d0f.js"><link rel="prefetch" href="/assets/js/page-ES中的概念与名词.a6e96ba4.js"><link rel="prefetch" href="/assets/js/page-ES的安装.6dc9c5bb.js"><link rel="prefetch" href="/assets/js/page-Elasticsearch.a196c3c1.js"><link rel="prefetch" href="/assets/js/page-Flexbox布局.de059221.js"><link rel="prefetch" href="/assets/js/page-Function扩展.4e383bc2.js"><link rel="prefetch" href="/assets/js/page-Generator.8e415bf3.js"><link rel="prefetch" href="/assets/js/page-Git.7636af87.js"><link rel="prefetch" href="/assets/js/page-Git工作流—分支策略.10a5bfd2.js"><link rel="prefetch" href="/assets/js/page-Git提交信息规范.6bf52dd3.js"><link rel="prefetch" href="/assets/js/page-Grid布局.bbd48fb0.js"><link rel="prefetch" href="/assets/js/page-HTML.d5ab6cf5.js"><link rel="prefetch" href="/assets/js/page-HTML基本结构.18e9b412.js"><link rel="prefetch" href="/assets/js/page-HTML规范.fbba67d4.js"><link rel="prefetch" href="/assets/js/page-HTML问题.1af110e5.js"><link rel="prefetch" href="/assets/js/page-Home.88aad06c.js"><link rel="prefetch" href="/assets/js/page-JSON扩展.d00f7976.js"><link rel="prefetch" href="/assets/js/page-JavaScript.0e17c8a3.js"><link rel="prefetch" href="/assets/js/page-JavaScript手写函数.f10c27f7.js"><link rel="prefetch" href="/assets/js/page-JavaScript规范.79858b50.js"><link rel="prefetch" href="/assets/js/page-Map.762c11f4.js"><link rel="prefetch" href="/assets/js/page-Module.ef73ddd8.js"><link rel="prefetch" href="/assets/js/page-MySQL.92140e99.js"><link rel="prefetch" href="/assets/js/page-MySQL主键和自增ID.e2a910ad.js"><link rel="prefetch" href="/assets/js/page-MySQL常用命令.126c820b.js"><link rel="prefetch" href="/assets/js/page-MySQL数据库设计规范.e9f6fc9b.js"><link rel="prefetch" href="/assets/js/page-MySQL数据类型.423ab011.js"><link rel="prefetch" href="/assets/js/page-MySQL的安装与卸载.123330a7.js"><link rel="prefetch" href="/assets/js/page-Nginx.cee00623.js"><link rel="prefetch" href="/assets/js/page-Nginx安全访问控制.461a15a9.js"><link rel="prefetch" href="/assets/js/page-Nginx常用命令.920b1c1e.js"><link rel="prefetch" href="/assets/js/page-Nginx文件列表功能.4aa3d6af.js"><link rel="prefetch" href="/assets/js/page-Nginx的卸载.dcd55692.js"><link rel="prefetch" href="/assets/js/page-Nginx的安装.9f6dd92b.js"><link rel="prefetch" href="/assets/js/page-Nginx设置开机自启.45940d36.js"><link rel="prefetch" href="/assets/js/page-Nginx部署Https安全认证.2a014582.js"><link rel="prefetch" href="/assets/js/page-Nginx部署前后端分离项目.c7ecbb8c.js"><link rel="prefetch" href="/assets/js/page-Nginx限流常用模块.a1554260.js"><link rel="prefetch" href="/assets/js/page-Nginx页面安全认证.8fb5473f.js"><link rel="prefetch" href="/assets/js/page-Ngixn配置文件模板.d57da99f.js"><link rel="prefetch" href="/assets/js/page-Ngixn配置文件详解.a6f5c7e2.js"><link rel="prefetch" href="/assets/js/page-Number.c83dedb4.js"><link rel="prefetch" href="/assets/js/page-ObjectfromEntries().5c97bc1a.js"><link rel="prefetch" href="/assets/js/page-Object扩展.436e8421.js"><link rel="prefetch" href="/assets/js/page-Promise.8536caa5.js"><link rel="prefetch" href="/assets/js/page-PromiseallSettled().0cfa1ff6.js"><link rel="prefetch" href="/assets/js/page-Promiseany()和AggregateError.d22dedc8.js"><link rel="prefetch" href="/assets/js/page-Promiseprototypefinally().544f00d9.js"><link rel="prefetch" href="/assets/js/page-Proxy.cc793724.js"><link rel="prefetch" href="/assets/js/page-Python.08afc131.js"><link rel="prefetch" href="/assets/js/page-React.25028562.js"><link rel="prefetch" href="/assets/js/page-ReactHooks（内置）.8c52d280.js"><link rel="prefetch" href="/assets/js/page-ReactHooks（自定义）.6761e11d.js"><link rel="prefetch" href="/assets/js/page-ReactJSX.52eff984.js"><link rel="prefetch" href="/assets/js/page-Redis.2f5a532d.js"><link rel="prefetch" href="/assets/js/page-Redis数据类型.a300aeaa.js"><link rel="prefetch" href="/assets/js/page-Redis的安装与卸载.916df964.js"><link rel="prefetch" href="/assets/js/page-Redis缓存三大问题.4b63470b.js"><link rel="prefetch" href="/assets/js/page-Reflect.8d22b004.js"><link rel="prefetch" href="/assets/js/page-RegExp扩展.c07b31f5.js"><link rel="prefetch" href="/assets/js/page-Set.538299ae.js"><link rel="prefetch" href="/assets/js/page-String扩展.93b50dc9.js"><link rel="prefetch" href="/assets/js/page-Symbol.f7bed33c.js"><link rel="prefetch" href="/assets/js/page-Symbol扩展.394d7abb.js"><link rel="prefetch" href="/assets/js/page-Term查询语法.5c906b08.js"><link rel="prefetch" href="/assets/js/page-TypeScript.67949fcb.js"><link rel="prefetch" href="/assets/js/page-UML类图.f8d76c4e.js"><link rel="prefetch" href="/assets/js/page-V8引擎的工作原理.60758d35.js"><link rel="prefetch" href="/assets/js/page-Vue3源码中的基础工具函数.1bcf71c1.js"><link rel="prefetch" href="/assets/js/page-Vuejs.11f2f30a.js"><link rel="prefetch" href="/assets/js/page-Vue项目规范.7dc7dd8d.js"><link rel="prefetch" href="/assets/js/page-Webpack5.149bca71.js"><link rel="prefetch" href="/assets/js/page-asyncawait.2e26eb3a.js"><link rel="prefetch" href="/assets/js/page-clone速度过慢.75cfab41.js"><link rel="prefetch" href="/assets/js/page-forawaitof.d824d48a.js"><link rel="prefetch" href="/assets/js/page-gitrebase的两种用法.5fdee7f3.js"><link rel="prefetch" href="/assets/js/page-globalThis.271ef279.js"><link rel="prefetch" href="/assets/js/page-let和const.592c8cd5.js"><link rel="prefetch" href="/assets/js/page-npm、yarn、pnpm区别.6e3ae860.js"><link rel="prefetch" href="/assets/js/page-pull时发现代码冲突，如何解决.1cae743a.js"><link rel="prefetch" href="/assets/js/page-this指向.66039947.js"><link rel="prefetch" href="/assets/js/page-中介者模式.9a79b1c1.js"><link rel="prefetch" href="/assets/js/page-事件循环机制，微任务和宏任务的关系.f3cab30a.js"><link rel="prefetch" href="/assets/js/page-产品与人性28个心理学效应.cf63bd44.js"><link rel="prefetch" href="/assets/js/page-代理模式.b41eb1f3.js"><link rel="prefetch" href="/assets/js/page-代码风格.01f615e7.js"><link rel="prefetch" href="/assets/js/page-伪元素和伪类.acbe5fbd.js"><link rel="prefetch" href="/assets/js/page-作用域.ffa0a6e1.js"><link rel="prefetch" href="/assets/js/page-使用Fabric执行SSH.c23ebb01.js"><link rel="prefetch" href="/assets/js/page-使用Paramiko执行SSH.5b9334f9.js"><link rel="prefetch" href="/assets/js/page-使用openpyxl处理新版本Excel.4dd994ef.js"><link rel="prefetch" href="/assets/js/page-使用smtplib发送电子邮件.dd1c2e3e.js"><link rel="prefetch" href="/assets/js/page-使用subprocess执行cmd.867477e8.js"><link rel="prefetch" href="/assets/js/page-使用telnetlib执行Telnet.9c46990a.js"><link rel="prefetch" href="/assets/js/page-使用xlrd处理旧版本Excel.27ce42c0.js"><link rel="prefetch" href="/assets/js/page-修改commit信息.9e220f28.js"><link rel="prefetch" href="/assets/js/page-修订FunctionprototypetoString().28c9bbf9.js"><link rel="prefetch" href="/assets/js/page-全文搜索语法.553bb8d9.js"><link rel="prefetch" href="/assets/js/page-公共变量、私有变量、保护变量.93399eeb.js"><link rel="prefetch" href="/assets/js/page-关于本站.789244c7.js"><link rel="prefetch" href="/assets/js/page-函数参数.a413f77c.js"><link rel="prefetch" href="/assets/js/page-函数类型.0bfdf347.js"><link rel="prefetch" href="/assets/js/page-函数组件设计模式.0bdb7389.js"><link rel="prefetch" href="/assets/js/page-函数装饰器.1ad1d632.js"><link rel="prefetch" href="/assets/js/page-刚刚的commit有误，想要撤回.b8f021a3.js"><link rel="prefetch" href="/assets/js/page-刚刚的push有误，想要撤回.9cffb848.js"><link rel="prefetch" href="/assets/js/page-前端登录方案总结.fe1961e9.js"><link rel="prefetch" href="/assets/js/page-前端路由原理.16b07700.js"><link rel="prefetch" href="/assets/js/page-动态引入.2463b890.js"><link rel="prefetch" href="/assets/js/page-包管理工具.ca6fca83.js"><link rel="prefetch" href="/assets/js/page-单例模式.d0361c8c.js"><link rel="prefetch" href="/assets/js/page-原型与原型链.8cb7c22e.js"><link rel="prefetch" href="/assets/js/page-原型模式.3b86814b.js"><link rel="prefetch" href="/assets/js/page-受控组件和非受控组件.c78ca8ba.js"><link rel="prefetch" href="/assets/js/page-变量与常量.6f0718b9.js"><link rel="prefetch" href="/assets/js/page-可选的CatchBinding.89e0d06f.js"><link rel="prefetch" href="/assets/js/page-可选链Optionalchaining.735f051f.js"><link rel="prefetch" href="/assets/js/page-同步与异步.73d50f82.js"><link rel="prefetch" href="/assets/js/page-同源策略.faa2a47c.js"><link rel="prefetch" href="/assets/js/page-命令模式.542461b6.js"><link rel="prefetch" href="/assets/js/page-响应式原理.c6aa8ba8.js"><link rel="prefetch" href="/assets/js/page-垃圾回收.ec92d34b.js"><link rel="prefetch" href="/assets/js/page-基本配置.c2eeb8b2.js"><link rel="prefetch" href="/assets/js/page-基础用法要点.cdac78f8.js"><link rel="prefetch" href="/assets/js/page-基础类型.59d2cf22.js"><link rel="prefetch" href="/assets/js/page-声明函数的六种方式.727a0228.js"><link rel="prefetch" href="/assets/js/page-备忘录模式.5ee2c863.js"><link rel="prefetch" href="/assets/js/page-复杂度分析.fd6aed6e.js"><link rel="prefetch" href="/assets/js/page-外观模式.f7419931.js"><link rel="prefetch" href="/assets/js/page-大文件分片上传和断点续传.28946d94.js"><link rel="prefetch" href="/assets/js/page-如何使用GitFlow工作流进行团队协作.1e5eb731.js"><link rel="prefetch" href="/assets/js/page-如何修改历史commits中的用户名和邮箱.243a3499.js"><link rel="prefetch" href="/assets/js/page-如何参与开源项目-提交PR与更新Fork分支.a96684d6.js"><link rel="prefetch" href="/assets/js/page-如何迁移仓库并保留commits记录.1e77efa6.js"><link rel="prefetch" href="/assets/js/page-字面量类型.0195046a.js"><link rel="prefetch" href="/assets/js/page-定位（position）.e91386fd.js"><link rel="prefetch" href="/assets/js/page-实例方法、类方法、静态方法.3080fe96.js"><link rel="prefetch" href="/assets/js/page-实现Objectcreate方法.184aaaa1.js"><link rel="prefetch" href="/assets/js/page-实现apply方法.32129a8a.js"><link rel="prefetch" href="/assets/js/page-实现bind方法.f8658abb.js"><link rel="prefetch" href="/assets/js/page-实现call方法.074f6cf0.js"><link rel="prefetch" href="/assets/js/page-实现instanceof运算符.df0988d3.js"><link rel="prefetch" href="/assets/js/page-实现new运算符.d201c2be.js"><link rel="prefetch" href="/assets/js/page-实现浅克隆（shallowClone）.4b8de5f7.js"><link rel="prefetch" href="/assets/js/page-实现深克隆（deepClone）.15232bbb.js"><link rel="prefetch" href="/assets/js/page-实现符合PromisesA+规范的Promise.b1f5d980.js"><link rel="prefetch" href="/assets/js/page-实现节流函数（throttle）.12a4265c.js"><link rel="prefetch" href="/assets/js/page-实现防抖函数（debounce）.2e792b8d.js"><link rel="prefetch" href="/assets/js/page-对象遍历的几种方式.da27b760.js"><link rel="prefetch" href="/assets/js/page-尾逗号Trailingcommas.4bd5d31d.js"><link rel="prefetch" href="/assets/js/page-工厂模式.d01edd77.js"><link rel="prefetch" href="/assets/js/page-已commit未push，想修改代码.1e3f5cf0.js"><link rel="prefetch" href="/assets/js/page-已commit未push，漏提交文件.d3cc7020.js"><link rel="prefetch" href="/assets/js/page-常用命令.aad14a0d.js"><link rel="prefetch" href="/assets/js/page-常用命令清单.062a829d.js"><link rel="prefetch" href="/assets/js/page-幂运算符.2cd4e8b3.js"><link rel="prefetch" href="/assets/js/page-建造者模式.c9717cd3.js"><link rel="prefetch" href="/assets/js/page-性能优化-产出代码.21791c2d.js"><link rel="prefetch" href="/assets/js/page-性能优化-构建速度.75cb0a3f.js"><link rel="prefetch" href="/assets/js/page-执行上下文和调用栈.69b5a1af.js"><link rel="prefetch" href="/assets/js/page-抽象工厂模式.9cdbdd00.js"><link rel="prefetch" href="/assets/js/page-接口类型与类型别名.c015390f.js"><link rel="prefetch" href="/assets/js/page-接口设计.9ea75833.js"><link rel="prefetch" href="/assets/js/page-搜索词自动补全语法.0045a2ec.js"><link rel="prefetch" href="/assets/js/page-数字分隔符.7fe02110.js"><link rel="prefetch" href="/assets/js/page-数据类型.fdf1bdd3.js"><link rel="prefetch" href="/assets/js/page-数据结构与算法.276262cd.js"><link rel="prefetch" href="/assets/js/page-数据结构之数组.fccb9a93.js"><link rel="prefetch" href="/assets/js/page-数据结构之链表.ce8db186.js"><link rel="prefetch" href="/assets/js/page-数组遍历的几种方式.2c7d968f.js"><link rel="prefetch" href="/assets/js/page-文案指南.fe19aa1b.js"><link rel="prefetch" href="/assets/js/page-文档基本操作.35de267d.js"><link rel="prefetch" href="/assets/js/page-文档规范.ec11e3a6.js"><link rel="prefetch" href="/assets/js/page-新的逻辑操作符.1fa6a470.js"><link rel="prefetch" href="/assets/js/page-更新日志.56cd0782.js"><link rel="prefetch" href="/assets/js/page-最佳实践-通用模板.adc97cd8.js"><link rel="prefetch" href="/assets/js/page-未完待续.7e51110d.js"><link rel="prefetch" href="/assets/js/page-枚举.aef4309c.js"><link rel="prefetch" href="/assets/js/page-栈空间和堆空间.60f82c24.js"><link rel="prefetch" href="/assets/js/page-核心概念.8ae5b4c8.js"><link rel="prefetch" href="/assets/js/page-桥接模式.0d7eff81.js"><link rel="prefetch" href="/assets/js/page-模板方法模式.ce4cfb87.js"><link rel="prefetch" href="/assets/js/page-模板编译.ebf1cc00.js"><link rel="prefetch" href="/assets/js/page-正向代理与反向代理.43b04d4b.js"><link rel="prefetch" href="/assets/js/page-泛型.29600092.js"><link rel="prefetch" href="/assets/js/page-浅克隆与深克隆.beb15277.js"><link rel="prefetch" href="/assets/js/page-浏览器内核与JavaScript引擎.04ceec11.js"><link rel="prefetch" href="/assets/js/page-浏览器宏观认识.b246c39e.js"><link rel="prefetch" href="/assets/js/page-浏览器相关.5d136979.js"><link rel="prefetch" href="/assets/js/page-浮动（float）.8c72ec42.js"><link rel="prefetch" href="/assets/js/page-渲染引擎的工作原理.b070be34.js"><link rel="prefetch" href="/assets/js/page-源码阅读与学习.117fc140.js"><link rel="prefetch" href="/assets/js/page-版本号定义规范.388d2c31.js"><link rel="prefetch" href="/assets/js/page-版本控制.25a6dad9.js"><link rel="prefetch" href="/assets/js/page-状态模式.9098a2a2.js"><link rel="prefetch" href="/assets/js/page-盒模型.8e794b68.js"><link rel="prefetch" href="/assets/js/page-空值合并运算符.50cb41d3.js"><link rel="prefetch" href="/assets/js/page-策略模式.37cb4c22.js"><link rel="prefetch" href="/assets/js/page-类变量和实例变量.036ad07a.js"><link rel="prefetch" href="/assets/js/page-类和实例.41c012ec.js"><link rel="prefetch" href="/assets/js/page-类型守卫.e19a0ce5.js"><link rel="prefetch" href="/assets/js/page-类的继承.e16f2cc1.js"><link rel="prefetch" href="/assets/js/page-类私有域.4be09380.js"><link rel="prefetch" href="/assets/js/page-类类型.0a7ab10f.js"><link rel="prefetch" href="/assets/js/page-组件渲染与更新.0dc97f32.js"><link rel="prefetch" href="/assets/js/page-组合查询语法.cbc2476d.js"><link rel="prefetch" href="/assets/js/page-组合模式.5f5fccae.js"><link rel="prefetch" href="/assets/js/page-经典布局.2da44dad.js"><link rel="prefetch" href="/assets/js/page-统计语法：聚合查询.4f3b3352.js"><link rel="prefetch" href="/assets/js/page-继承的八种方式.7023acec.js"><link rel="prefetch" href="/assets/js/page-编译器与解释器.7addef86.js"><link rel="prefetch" href="/assets/js/page-网络安全协议（HTTPS）.e3e7b027.js"><link rel="prefetch" href="/assets/js/page-职责链模式.9e619401.js"><link rel="prefetch" href="/assets/js/page-联合类型与交叉类型.8ae1fb36.js"><link rel="prefetch" href="/assets/js/page-虚拟DOM与diff算法.e58b101e.js"><link rel="prefetch" href="/assets/js/page-装饰器模式.d6e169f7.js"><link rel="prefetch" href="/assets/js/page-观察者模式.0eec37c6.js"><link rel="prefetch" href="/assets/js/page-解决vim中文乱码问题.bd0499cb.js"><link rel="prefetch" href="/assets/js/page-解决方案.4e5ba7e3.js"><link rel="prefetch" href="/assets/js/page-解构赋值.d7b2ec92.js"><link rel="prefetch" href="/assets/js/page-认知偏差知识手册.fa3cf8a7.js"><link rel="prefetch" href="/assets/js/page-设计原则.248bd817.js"><link rel="prefetch" href="/assets/js/page-设计模式.0a11c0d7.js"><link rel="prefetch" href="/assets/js/page-设计模式简介.7ef03fad.js"><link rel="prefetch" href="/assets/js/page-访问者模式和解释器模式.2a528a93.js"><link rel="prefetch" href="/assets/js/page-语义类标签.0973d868.js"><link rel="prefetch" href="/assets/js/page-语法规范.d00e650d.js"><link rel="prefetch" href="/assets/js/page-课外学习.3c01248a.js"><link rel="prefetch" href="/assets/js/page-调用函数的四种方式.cc12f8be.js"><link rel="prefetch" href="/assets/js/page-负载均衡.a75b3c01.js"><link rel="prefetch" href="/assets/js/page-跨站脚本攻击（XSS）.61672ea0.js"><link rel="prefetch" href="/assets/js/page-迭代器模式.d8263be8.js"><link rel="prefetch" href="/assets/js/page-适配器模式.a4fe6b0d.js"><link rel="prefetch" href="/assets/js/page-选择器与样式优先级.ee07a887.js"><link rel="prefetch" href="/assets/js/page-配置密钥实现免密操作.cab9f11d.js"><link rel="prefetch" href="/assets/js/page-长度和单位.69655dab.js"><link rel="prefetch" href="/assets/js/page-闭包.43f87f8a.js"><link rel="prefetch" href="/assets/js/page-面向对象编程.4f145627.js"><link rel="prefetch" href="/assets/js/page-高级用法特性.06ae6359.js"><link rel="prefetch" href="/assets/js/page-高级配置.0ce93c5a.js"><link rel="prefetch" href="/assets/js/page-高阶函数.3b78d72f.js"><link rel="prefetch" href="/assets/js/vendors~layout-Slide.7b7dada9.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ccbf91ab.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container has-navbar has-sidebar has-anchor"><header class="navbar"><!----> <div class="content__navbar-start"></div> <button title="Sidebar Button" class="sidebar-button"><span class="icon"></span></button> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="前端修炼小册" class="logo"> <!----> <span class="site-name can-hide">前端修炼小册</span></a> <!----> <div class="content__navbar-center"></div> <div class="links"><!----> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术规范" class="dropdown-title"><span class="title"><!---->
        技术规范
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/style-guide/version-control/" class="nav-link"><!---->
  版本控制
</a></li><li class="dropdown-item"><a href="/style-guide/program/" class="nav-link"><!---->
  代码风格
</a></li><li class="dropdown-item"><a href="/style-guide/document/" class="nav-link"><!---->
  文档规范
</a></li><li class="dropdown-item"><a href="/style-guide/apis/" class="nav-link"><!---->
  接口设计
</a></li><li class="dropdown-item"><a href="/style-guide/product/" class="nav-link"><!---->
  文案指南
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端知识" class="dropdown-title"><span class="title"><!---->
        前端知识
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>基础</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend-knowledge/html/" class="nav-link"><!---->
  HTML
</a></li><li class="dropdown-subitem"><a href="/frontend-knowledge/css/" class="nav-link"><!---->
  CSS
</a></li><li class="dropdown-subitem"><a href="/frontend-knowledge/javascript/" class="nav-link"><!---->
  JavaScript
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>进阶</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend-knowledge/es6-and-beyond/" class="nav-link"><!---->
  ECMAScript 6+
</a></li><li class="dropdown-subitem"><a href="/frontend-knowledge/typescript/" class="nav-link"><!---->
  TypeScript
</a></li><li class="dropdown-subitem"><a href="/frontend-knowledge/browser/" class="nav-link"><!---->
  浏览器相关
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>手写</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend-knowledge/javascript-handwritten/" class="nav-link"><!---->
  JS 手写
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title"><!---->
        工程化
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>框架</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend-engineering/vuejs/" class="nav-link"><!---->
  Vue.js
</a></li><li class="dropdown-subitem"><a href="/frontend-engineering/react/" class="nav-link"><!---->
  React
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>工具</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend-engineering/webpack/" class="nav-link"><!---->
  Webpack
</a></li><li class="dropdown-subitem"><a href="/frontend-engineering/package/" class="nav-link"><!---->
  包管理工具
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="必知必会" class="dropdown-title"><span class="title"><!---->
        必知必会
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>常用工具</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/basic-skills/git/" class="nav-link"><!---->
  Git
</a></li><li class="dropdown-subitem"><a href="/basic-skills/nginx/" class="nav-link"><!---->
  Nginx
</a></li><li class="dropdown-subitem"><a href="/basic-skills/linux/common-commands/" class="nav-link"><!---->
  Linux
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>数据库/中间件</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/basic-skills/mysql/" class="nav-link"><!---->
  MySQL
</a></li><li class="dropdown-subitem"><a href="/basic-skills/redis/" class="nav-link"><!---->
  Redis
</a></li><li class="dropdown-subitem"><a href="/basic-skills/elasticsearch/" class="nav-link"><!---->
  Elasticsearch
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="深入学习" class="dropdown-title"><span class="title"><!---->
        深入学习
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/in-depth-learning/algorithm/" class="nav-link"><!---->
  数据结构与算法
</a></li><li class="dropdown-item"><a href="/in-depth-learning/design-patterns/" class="nav-link router-link-active active"><!---->
  设计模式
</a></li><li class="dropdown-item"><a href="/in-depth-learning/source-code/" class="nav-link"><!---->
  源码阅读与学习
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端知识" class="dropdown-title"><span class="title"><!---->
        后端知识
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/backend-knowledge/python/" class="nav-link"><!---->
  Python
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="项目相关" class="dropdown-title"><span class="title"><!---->
        项目相关
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><a href="/project/solutions/" class="nav-link"><!---->
  解决方案
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其它" class="dropdown-title"><span class="title"><!---->
        其它
      </span> <span class="arrow"></span></button> <ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>站内</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/" class="nav-link"><!---->
  关于本站
</a></li><li class="dropdown-subitem"><a href="/extracurricular/" class="nav-link"><!---->
  课外学习
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>站外</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.wenyuanblog.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://github.com/wenyuan" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.wenyuanblog.com/gift.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  支持一下
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>线路</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.fedbook.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  国内
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://wenyuan.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  国外
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div></nav> <!----> <!----> <!----> <div class="content__navbar-end"></div></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!----> <!----> <div class="content__sidebar-top"></div> <nav class="sidebar-nav-links"><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="技术规范" class="dropdown-title"><span class="title"><!---->
      技术规范
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/style-guide/version-control/" class="nav-link"><!---->
  版本控制
</a></li><li class="dropdown-item"><!----> <a href="/style-guide/program/" class="nav-link"><!---->
  代码风格
</a></li><li class="dropdown-item"><!----> <a href="/style-guide/document/" class="nav-link"><!---->
  文档规范
</a></li><li class="dropdown-item"><!----> <a href="/style-guide/apis/" class="nav-link"><!---->
  接口设计
</a></li><li class="dropdown-item"><!----> <a href="/style-guide/product/" class="nav-link"><!---->
  文案指南
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="前端知识" class="dropdown-title"><span class="title"><!---->
      前端知识
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>基础</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend-knowledge/html/" class="nav-link"><!---->
  HTML
</a></li><li class="dropdown-subitem"><a href="/frontend-knowledge/css/" class="nav-link"><!---->
  CSS
</a></li><li class="dropdown-subitem"><a href="/frontend-knowledge/javascript/" class="nav-link"><!---->
  JavaScript
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>进阶</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend-knowledge/es6-and-beyond/" class="nav-link"><!---->
  ECMAScript 6+
</a></li><li class="dropdown-subitem"><a href="/frontend-knowledge/typescript/" class="nav-link"><!---->
  TypeScript
</a></li><li class="dropdown-subitem"><a href="/frontend-knowledge/browser/" class="nav-link"><!---->
  浏览器相关
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>手写</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend-knowledge/javascript-handwritten/" class="nav-link"><!---->
  JS 手写
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="工程化" class="dropdown-title"><span class="title"><!---->
      工程化
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>框架</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend-engineering/vuejs/" class="nav-link"><!---->
  Vue.js
</a></li><li class="dropdown-subitem"><a href="/frontend-engineering/react/" class="nav-link"><!---->
  React
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>工具</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend-engineering/webpack/" class="nav-link"><!---->
  Webpack
</a></li><li class="dropdown-subitem"><a href="/frontend-engineering/package/" class="nav-link"><!---->
  包管理工具
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="必知必会" class="dropdown-title"><span class="title"><!---->
      必知必会
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>常用工具</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/basic-skills/git/" class="nav-link"><!---->
  Git
</a></li><li class="dropdown-subitem"><a href="/basic-skills/nginx/" class="nav-link"><!---->
  Nginx
</a></li><li class="dropdown-subitem"><a href="/basic-skills/linux/common-commands/" class="nav-link"><!---->
  Linux
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>数据库/中间件</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/basic-skills/mysql/" class="nav-link"><!---->
  MySQL
</a></li><li class="dropdown-subitem"><a href="/basic-skills/redis/" class="nav-link"><!---->
  Redis
</a></li><li class="dropdown-subitem"><a href="/basic-skills/elasticsearch/" class="nav-link"><!---->
  Elasticsearch
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="深入学习" class="dropdown-title"><span class="title"><!---->
      深入学习
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/in-depth-learning/algorithm/" class="nav-link"><!---->
  数据结构与算法
</a></li><li class="dropdown-item"><!----> <a href="/in-depth-learning/design-patterns/" class="nav-link router-link-active active"><!---->
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/in-depth-learning/source-code/" class="nav-link"><!---->
  源码阅读与学习
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="后端知识" class="dropdown-title"><span class="title"><!---->
      后端知识
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backend-knowledge/python/" class="nav-link"><!---->
  Python
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="项目相关" class="dropdown-title"><span class="title"><!---->
      项目相关
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/project/solutions/" class="nav-link"><!---->
  解决方案
</a></li></ul></div></div><div class="nav-item"><div class="mobile-dropdown-wrapper"><button type="button" aria-label="其它" class="dropdown-title"><span class="title"><!---->
      其它
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>站内</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/about/" class="nav-link"><!---->
  关于本站
</a></li><li class="dropdown-subitem"><a href="/extracurricular/" class="nav-link"><!---->
  课外学习
</a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>站外</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.wenyuanblog.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  博客
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://github.com/wenyuan" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.wenyuanblog.com/gift.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  支持一下
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>线路</span></h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://www.fedbook.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  国内
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://wenyuan.github.io/" target="_blank" rel="noopener noreferrer" class="nav-link external"><!---->
  国外
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <!----></nav> <!----> <div class="content__sidebar-center"></div> <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">前置知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/in-depth-learning/design-patterns/5-principles/" class="sidebar-link">五大设计原则</a></li><li><a href="/in-depth-learning/design-patterns/23-patterns/" class="sidebar-link">23 种设计模式</a></li><li><a href="/in-depth-learning/design-patterns/uml-class-diagram/" class="sidebar-link">UML 类图</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">创建型模式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/in-depth-learning/design-patterns/factory-pattern/" class="sidebar-link">工厂模式</a></li><li><a href="/in-depth-learning/design-patterns/abstract-factory-pattern/" class="sidebar-link">抽象工厂模式</a></li><li><a href="/in-depth-learning/design-patterns/builder-pattern/" class="sidebar-link">建造者模式</a></li><li><a href="/in-depth-learning/design-patterns/singleton-pattern/" class="sidebar-link">单例模式</a></li><li><a href="/in-depth-learning/design-patterns/prototype-pattern/" class="sidebar-link">原型模式(前端不常用)</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><!----> <span class="title">结构型模式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/in-depth-learning/design-patterns/adapter-pattern/" class="sidebar-link">适配器模式</a></li><li><a href="/in-depth-learning/design-patterns/decorator-pattern/" class="sidebar-link">装饰器模式</a></li><li><a href="/in-depth-learning/design-patterns/proxy-pattern/" class="sidebar-link">代理模式</a></li><li><a href="/in-depth-learning/design-patterns/facade-pattern/" class="sidebar-link">外观模式</a></li><li><a href="/in-depth-learning/design-patterns/bridge-pattern/" class="sidebar-link">桥接模式(前端不常用)</a></li><li><a href="/in-depth-learning/design-patterns/composite-pattern/" class="sidebar-link">组合模式(前端不常用)</a></li><li><a href="/in-depth-learning/design-patterns/flyweight-pattern/" aria-current="page" class="active sidebar-link">享元模式(前端不常用)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#介绍" class="sidebar-link">介绍</a></li><li class="sidebar-sub-header"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#通俗的示例" class="sidebar-link">通俗的示例</a></li><li class="sidebar-sub-header"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#享元模式的通用实现" class="sidebar-link">享元模式的通用实现</a></li><li class="sidebar-sub-header"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#享元模式改进" class="sidebar-link">享元模式改进</a></li><li class="sidebar-sub-header"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#资源池" class="sidebar-link">资源池</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#线程池" class="sidebar-link heading3">线程池</a></li><li class="sidebar-sub-header"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#缓存" class="sidebar-link heading3">缓存</a></li><li class="sidebar-sub-header"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#连接池" class="sidebar-link heading3">连接池</a></li><li class="sidebar-sub-header"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#字符常量池" class="sidebar-link heading3">字符常量池</a></li></ul></li><li class="sidebar-sub-header"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#设计原则验证" class="sidebar-link">设计原则验证</a></li><li class="sidebar-sub-header"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#享元模式的优缺点" class="sidebar-link">享元模式的优缺点</a></li><li class="sidebar-sub-header"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#享元模式的适用场景" class="sidebar-link">享元模式的适用场景</a></li><li class="sidebar-sub-header"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#其他相关模式" class="sidebar-link">其他相关模式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#享元模式和工厂模式、单例模式" class="sidebar-link heading3">享元模式和工厂模式、单例模式</a></li><li class="sidebar-sub-header"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#享元模式和组合模式" class="sidebar-link heading3">享元模式和组合模式</a></li><li class="sidebar-sub-header"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#享元模式和策略模式" class="sidebar-link heading3">享元模式和策略模式</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><!----> <span class="title">行为型模式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/in-depth-learning/design-patterns/observer-pattern/" class="sidebar-link">观察者模式</a></li><li><a href="/in-depth-learning/design-patterns/iterator-pattern/" class="sidebar-link">迭代器模式</a></li><li><a href="/in-depth-learning/design-patterns/state-pattern/" class="sidebar-link">状态模式</a></li><li><a href="/in-depth-learning/design-patterns/strategy-pattern/" class="sidebar-link">策略模式(前端不常用)</a></li><li><a href="/in-depth-learning/design-patterns/template-method-pattern/" class="sidebar-link">模板方法模式(前端不常用)</a></li><li><a href="/in-depth-learning/design-patterns/chain-of-responsibility-pattern/" class="sidebar-link">职责链模式(前端不常用)</a></li><li><a href="/in-depth-learning/design-patterns/command-pattern/" class="sidebar-link">命令模式(前端不常用)</a></li><li><a href="/in-depth-learning/design-patterns/memento-pattern/" class="sidebar-link">备忘录模式(前端不常用)</a></li><li><a href="/in-depth-learning/design-patterns/mediator-pattern/" class="sidebar-link">中介者模式(前端不常用)</a></li><li><a href="/in-depth-learning/design-patterns/visitor-pattern-and-interpreter-pattern/" class="sidebar-link">访问者模式和解释器模式(不常用)</a></li></ul></section></li></ul> <!----> <div class="content__sidebar-bottom"></div> <!----></aside> <main class="page"><nav class="breadcrumb disable"><!----></nav> <!----> <div class="content__page-top"></div> <div vocab="https://schema.org/" typeof="Article" class="page-title"><h1><!----> <span property="headline">享元模式</span></h1> <!----> <!----> <hr></div> <div class="anchor-place-holder"><aside id="anchor"><div class="anchor-wrapper"><ul class="anchor-list"><li class="anchor"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#介绍" class="anchor-link heading2"><div>介绍</div></a></li><li class="anchor"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#通俗的示例" class="anchor-link heading2"><div>通俗的示例</div></a></li><li class="anchor"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#享元模式的通用实现" class="anchor-link heading2"><div>享元模式的通用实现</div></a></li><li class="anchor"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#享元模式改进" class="anchor-link heading2"><div>享元模式改进</div></a></li><li class="anchor"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#资源池" class="anchor-link heading2"><div>资源池</div></a></li><li class="anchor"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#线程池" class="anchor-link heading3"><div>线程池</div></a></li><li class="anchor"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#缓存" class="anchor-link heading3"><div>缓存</div></a></li><li class="anchor"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#连接池" class="anchor-link heading3"><div>连接池</div></a></li><li class="anchor"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#字符常量池" class="anchor-link heading3"><div>字符常量池</div></a></li><li class="anchor"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#设计原则验证" class="anchor-link heading2"><div>设计原则验证</div></a></li><li class="anchor"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#享元模式的优缺点" class="anchor-link heading2"><div>享元模式的优缺点</div></a></li><li class="anchor"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#享元模式的适用场景" class="anchor-link heading2"><div>享元模式的适用场景</div></a></li><li class="anchor"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#其他相关模式" class="anchor-link heading2"><div>其他相关模式</div></a></li><li class="anchor"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#享元模式和工厂模式、单例模式" class="anchor-link heading3"><div>享元模式和工厂模式、单例模式</div></a></li><li class="anchor"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#享元模式和组合模式" class="anchor-link heading3"><div>享元模式和组合模式</div></a></li><li class="anchor"><a href="/in-depth-learning/design-patterns/flyweight-pattern/#享元模式和策略模式" class="anchor-link heading3"><div>享元模式和策略模式</div></a></li></ul></div></aside></div> <!----> <div class="content__content-top"></div> <div class="theme-default-content content__default"><h1 id="享元模式"><a href="#享元模式" class="header-anchor">#</a> 享元模式</h1> <h2 id="介绍"><a href="#介绍" class="header-anchor">#</a> 介绍</h2> <p>享元模式（Flyweight Pattern）运用共享技术来有效地支持大量细粒度对象的复用，以减少创建的对象的数量。</p> <p>享元模式的主要思想是<strong>共享细粒度对象</strong>，也就是说如果系统中存在多个相同的对象，那么只需共享一份就可以了，不必每个都去实例化每一个对象，这样来精简内存资源，提升性能和效率。</p> <p>简单来说，</p> <ul><li>共享内存（主要考虑内存，而非效率）</li> <li>相同的数据，共享使用</li> <li>但是前端主要运行在客户端，所以使用场景不多。</li></ul> <blockquote><p>Fly 意为苍蝇，Flyweight 指轻蝇量级，指代对象粒度很小。</p></blockquote> <h2 id="通俗的示例"><a href="#通俗的示例" class="header-anchor">#</a> 通俗的示例</h2> <p>我们去驾考的时候，如果给每个考试的人都准备一辆车，那考场就挤爆了，考点都堆不下考试车，因此驾考现场一般会有几辆车给要考试的人依次使用。如果考生人数少，就分别少准备几个自动档和手动档的驾考车，考生多的话就多准备几辆。如果考手动档的考生比较多，就多准备几辆手动档的驾考车。</p> <p>生活中类似的场景还有很多，比如咖啡厅的咖啡口味，餐厅的菜品种类，拳击比赛的重量级等等。</p> <p>在类似场景中，这些例子有以下特点：</p> <ul><li>目标对象具有一些共同的状态，比如驾考考生考的是自动档还是手动档。</li> <li>这些共同的状态所对应的对象，可以被共享出来。</li></ul> <h2 id="享元模式的通用实现"><a href="#享元模式的通用实现" class="header-anchor">#</a> 享元模式的通用实现</h2> <p>首先假设考生的 ID 为奇数则考的是手动档，为偶数则考的是自动档。如果给所有考生都 <code>new</code> 一个驾考车，那么这个系统中就会创建了和考生数量一致的驾考车对象：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> candidateNum <span class="token operator">=</span> <span class="token number">10</span>   <span class="token comment">// 考生数量</span>
<span class="token keyword">var</span> examCarNum <span class="token operator">=</span> <span class="token number">0</span>      <span class="token comment">// 驾考车的数量</span>

<span class="token comment">/* 驾考车构造函数 */</span>
<span class="token keyword">function</span> <span class="token function">ExamCar</span><span class="token punctuation">(</span><span class="token parameter">carType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  examCarNum<span class="token operator">++</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>carId <span class="token operator">=</span> examCarNum
  <span class="token keyword">this</span><span class="token punctuation">.</span>carType <span class="token operator">=</span> carType <span class="token operator">?</span> <span class="token string">'手动档'</span> <span class="token operator">:</span> <span class="token string">'自动档'</span>
<span class="token punctuation">}</span>

<span class="token class-name">ExamCar</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">examine</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">candidateId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'考生- '</span> <span class="token operator">+</span> candidateId <span class="token operator">+</span> <span class="token string">' 在'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carType <span class="token operator">+</span> <span class="token string">'驾考车- '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carId <span class="token operator">+</span> <span class="token string">' 上考试'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> candidateId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> candidateId <span class="token operator">&lt;=</span> candidateNum<span class="token punctuation">;</span> candidateId<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> examCar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExamCar</span><span class="token punctuation">(</span>candidateId <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span>
  examCar<span class="token punctuation">.</span><span class="token function">examine</span><span class="token punctuation">(</span>candidateId<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'驾考车总数 - '</span> <span class="token operator">+</span> examCarNum<span class="token punctuation">)</span>
<span class="token comment">// 输出: 驾考车总数 - 10</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>如果考生很多，那么系统中就会存在更多个驾考车对象实例，假如驾考车对象比较复杂，那么这些新建的驾考车实例就会占用大量内存。这时我们将同种类型的驾考车实例进行合并，手动档和自动档档驾考车分别引用同一个实例，就可以节约大量内存：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> candidateNum <span class="token operator">=</span> <span class="token number">10</span>   <span class="token comment">// 考生数量</span>
<span class="token keyword">var</span> examCarNum <span class="token operator">=</span> <span class="token number">0</span>      <span class="token comment">// 驾考车的数量</span>

<span class="token comment">/* 驾考车构造函数 */</span>
<span class="token keyword">function</span> <span class="token function">ExamCar</span><span class="token punctuation">(</span><span class="token parameter">carType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  examCarNum<span class="token operator">++</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>carId <span class="token operator">=</span> examCarNum
  <span class="token keyword">this</span><span class="token punctuation">.</span>carType <span class="token operator">=</span> carType <span class="token operator">?</span> <span class="token string">'手动档'</span> <span class="token operator">:</span> <span class="token string">'自动档'</span>
<span class="token punctuation">}</span>

<span class="token class-name">ExamCar</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">examine</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">candidateId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'考生- '</span> <span class="token operator">+</span> candidateId <span class="token operator">+</span> <span class="token string">' 在'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carType <span class="token operator">+</span> <span class="token string">'驾考车- '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carId <span class="token operator">+</span> <span class="token string">' 上考试'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> manualExamCar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExamCar</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> autoExamCar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExamCar</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> candidateId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> candidateId <span class="token operator">&lt;=</span> candidateNum<span class="token punctuation">;</span> candidateId<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> examCar <span class="token operator">=</span> candidateId <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">?</span> manualExamCar <span class="token operator">:</span> autoExamCar
  examCar<span class="token punctuation">.</span><span class="token function">examine</span><span class="token punctuation">(</span>candidateId<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'驾考车总数 - '</span> <span class="token operator">+</span> examCarNum<span class="token punctuation">)</span>
<span class="token comment">// 输出: 驾考车总数 - 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>可以看到我们使用 2 个驾考车实例就实现了刚刚 10 个驾考车实例实现的功能。这是仅有 10 个考生的情况，如果有几百上千考生，这时我们节约的内存就比较可观了，这就是享元模式要达到的目的。</p> <h2 id="享元模式改进"><a href="#享元模式改进" class="header-anchor">#</a> 享元模式改进</h2> <p>在原型链继承和组合继承中，子类通过原型 <code>prototype</code> 来复用父类的方法和属性，如果子类实例每次都创建新的方法与属性，那么在子类实例很多的情况下，内存中就存在有很多重复的方法和属性，即使这些方法和属性完全一样，因此这部分内存完全可以通过复用来优化，这也是享元模式的思想。</p> <p>传统的享元模式是将目标对象的状态区分为<strong>内部状态</strong>和<strong>外部状态</strong>，内部状态相同的对象可以被共享出来指向同一个内部状态。正如之前举的驾考例子中，自动档还是手动档，就属于驾考考生中的内部状态，对应的驾考车就是可以被共享的对象。而考生的年龄、姓名、籍贯等就属于外部状态，一般没有被共享出来的价值。</p> <p>主要的原理可以参看下面的示意图：</p> <div style="text-align:center;"><img src="/assets/img/flyweight-pattern.031a3565.jpg" alt="享元模式示意图" style="width:640px;"> <p style="text-align:center;color:#888;">（享元模式示意图）</p></div> <p>享元模式的主要思想是细粒度对象的共享和复用，因此对之前的驾考例子，我们可以继续改进一下：</p> <ul><li>如果某考生正在使用一辆驾考车，那么这辆驾考车的状态就是被占用，其他考生只能选择剩下未被占用状态的驾考车。</li> <li>如果某考生对驾考车的使用完毕，那么将驾考车开回考点，驾考车的状态改为未被占用，供给其他考生使用。</li> <li>如果所有驾考车都被占用，那么其他考生只能等待正在使用驾考车的考生使用完毕，直到有驾考车的状态变为未被占用。</li> <li>组织单位可以根据考生数量多准备几辆驾考车，比如手动档考生比较多，那么手动档驾考车就应该比自动档驾考车多准备几辆。</li></ul> <p>接下来简单实现一下，首先创建 3 个手动档驾考车，然后注册 10 个考生参与考试，一开始肯定有 3 个考生同时上车，然后在某个考生考完之后其他考生接着后面考。为了实现这个过程，这里使用了 <code>Promise</code>，考试的考生在 0 到 2 秒后的随机时间考试完毕归还驾考车，其他考生在前面考生考完之后接着进行考试：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> examCarNum <span class="token operator">=</span> <span class="token number">0</span>                  <span class="token comment">// 驾考车总数</span>

<span class="token comment">/* 驾考车对象 */</span>
<span class="token keyword">class</span> <span class="token class-name">ExamCar</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">carType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    examCarNum<span class="token operator">++</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>carId <span class="token operator">=</span> examCarNum
    <span class="token keyword">this</span><span class="token punctuation">.</span>carType <span class="token operator">=</span> carType <span class="token operator">?</span> <span class="token string">'手动档'</span> <span class="token operator">:</span> <span class="token string">'自动档'</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>usingState <span class="token operator">=</span> <span class="token boolean">false</span>    <span class="token comment">// 是否正在使用</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/* 在本车上考试 */</span>
  <span class="token function">examine</span><span class="token punctuation">(</span><span class="token parameter">candidateId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>usingState <span class="token operator">=</span> <span class="token boolean">true</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">考生- </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> candidateId <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 开始在</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carType <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">驾考车- </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carId <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 上考试</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>usingState <span class="token operator">=</span> <span class="token boolean">false</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">%c考生- </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> candidateId <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 在</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carType <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">驾考车- </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> <span class="token keyword">this</span><span class="token punctuation">.</span>carId <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 上考试完毕</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">'color:#f40'</span><span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                       <span class="token comment">// 0~2秒后考试完毕</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 手动档汽车对象池 */</span>
ManualExamCarPool <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">_pool</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                  <span class="token comment">// 驾考车对象池</span>
  <span class="token literal-property property">_candidateQueue</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token comment">// 考生队列</span>

  <span class="token comment">/* 注册考生 ID 列表 */</span>
  <span class="token function">registCandidates</span><span class="token punctuation">(</span><span class="token parameter">candidateList</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    candidateList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">candidateId</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registCandidate</span><span class="token punctuation">(</span>candidateId<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/* 注册手动档考生 */</span>
  <span class="token function">registCandidate</span><span class="token punctuation">(</span><span class="token parameter">candidateId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> examCar <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getManualExamCar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token comment">// 找一个未被占用的手动档驾考车</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>examCar<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      examCar<span class="token punctuation">.</span><span class="token function">examine</span><span class="token punctuation">(</span>candidateId<span class="token punctuation">)</span>           <span class="token comment">// 开始考试，考完了让队列中的下一个考生开始考试</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> nextCandidateId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_candidateQueue<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_candidateQueue<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          nextCandidateId <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">registCandidate</span><span class="token punctuation">(</span>nextCandidateId<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_candidateQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>candidateId<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/* 注册手动档车 */</span>
  <span class="token function">initManualExamCar</span><span class="token punctuation">(</span><span class="token parameter">manualExamCarNum</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> manualExamCarNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_pool<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ExamCar</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">/* 获取状态为未被占用的手动档车 */</span>
  <span class="token function">getManualExamCar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_pool<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">car</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span>car<span class="token punctuation">.</span>usingState<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

ManualExamCarPool<span class="token punctuation">.</span><span class="token function">initManualExamCar</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>          <span class="token comment">// 一共有3个驾考车</span>
ManualExamCarPool<span class="token punctuation">.</span><span class="token function">registCandidates</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">// 10个考生来考试</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><p>在浏览器中运行下试试，可以看到一个驾考的过程被模拟出来了，这里只简单实现了手动档，自动档驾考场景同理，就不进行实现了。上面的实现还可以进一步优化，比如考生多的时候自动新建驾考车，考生少的时候逐渐减少驾考车，但又不能无限新建驾考车对象，这些情况可以自行发挥。</p> <p>如果可以将目标对象的内部状态和外部状态区分的比较明显，就可以将内部状态一致的对象很方便地共享出来，但是对 JavaScript 来说，我们并不一定要严格区分内部状态和外部状态才能进行资源共享，比如资源池模式。</p> <h2 id="资源池"><a href="#资源池" class="header-anchor">#</a> 资源池</h2> <p>上面这种改进的模式一般叫做<strong>资源池</strong>（Resource Pool），或者叫对象池（Object Pool），可以当作是享元模式的升级版，实现不一样，但是目的相同。资源池一般维护一个装载对象的池子，封装有获取、释放资源的方法，当需要对象的时候直接从资源池中获取，使用完毕之后释放资源等待下次被获取。</p> <p>在上面的例子中，驾考车相当于有限资源，考生作为访问者根据资源的使用情况从资源池中获取资源，如果资源池中的资源都正在被占用，要么资源池创建新的资源，要么访问者等待占用的资源被释放。</p> <p>资源池在后端应用相当广泛，比如缓冲池、连接池、线程池、字符常量池等场景，前端使用场景不多，但是也有使用，比如有些频繁的 DOM 创建销毁操作，就可以引入对象池来节约一些 DOM 创建损耗。</p> <p>下面介绍资源池的几种主要应用。</p> <h3 id="线程池"><a href="#线程池" class="header-anchor">#</a> 线程池</h3> <p>以 Node.js 中的线程池为例，Node.js 的 JavaScript 引擎是执行在单线程中的，启动的时候会新建 4 个线程放到线程池中，当遇到一些异步 I/O 操作（比如文件异步读写、DNS 查询等）或者一些 CPU 密集的操作（Crypto、Zlib 模块等）的时候，会在线程池中拿出一个线程去执行。如果有需要，线程池会按需创建新的线程。</p> <p>线程池在整个 Node.js 事件循环中的位置可以参照下图：</p> <div style="text-align:center;"><img src="/assets/img/node-thread-pool.b010f356.jpg" alt="Node.js 线程池" style="width:640px;"> <p style="text-align:center;color:#888;">（Node.js 线程池）</p></div> <p>上面这个图就是 Node.js 的事件循环（Event Loop）机制，简单解读一下（扩展视野，不一定需要懂）：</p> <ul><li>所有任务都在主线程上执行，形成执行栈（Execution Context Stack）。</li> <li>主线程之外维护一个任务队列（Task Queue），接到请求时将请求作为一个任务放入这个队列中，然后继续接收其他请求。</li> <li>一旦执行栈中的任务执行完毕，主线程空闲时，主线程读取任务队列中的任务，检查队列中是否有要处理的事件，这时要分两种情况：如果是非 I/O 任务，就亲自处理，并通过回调函数返回到上层调用；如果是 I/O 任务，将传入的参数和回调函数封装成请求对象，并将这个请求对象推入线程池等待执行，主线程则读取下一个任务队列的任务，以此类推处理完任务队列中的任务。</li> <li>线程池当线程可用时，取出请求对象执行 I/O 操作，任务完成以后归还线程，并把这个完成的事件放到任务队列的尾部，等待事件循环，当主线程再次循环到该事件时，就直接处理并返回给上层调用。</li></ul> <h3 id="缓存"><a href="#缓存" class="header-anchor">#</a> 缓存</h3> <p>根据二八原则，80% 的请求其实访问的是 20% 的资源，我们可以将频繁访问的资源缓存起来，如果用户访问被缓存起来的资源就直接返回缓存的版本，这就是 Web 开发中经常遇到的<strong>缓存</strong>。</p> <p>缓存服务器就是缓存的最常见应用之一，也是复用资源的一种常用手段。缓存服务器的示意图如下：</p> <div style="text-align:center;"><img src="/assets/img/cache-server.c878d4f0.jpg" alt="缓存服务器示意图" style="width:640px;"> <p style="text-align:center;color:#888;">（缓存服务器示意图）</p></div> <p>缓存服务器位于访问者与业务服务器之间，对业务服务器来说，减轻了压力，减小了负载，提高了数据查询的性能。对用户来说，提升了网页打开速度，优化了体验。</p> <p>缓存技术用的非常多，不仅仅用在缓存服务器上，浏览器本地也有缓存，查询的 DNS 也有缓存，包括我们的电脑 CPU 上，也有缓存硬件。</p> <h3 id="连接池"><a href="#连接池" class="header-anchor">#</a> 连接池</h3> <p>我们知道对数据库进行操作需要先创建一个数据库连接对象，然后通过创建好的数据库连接来对数据库进行 CRUD（增删改查）操作。如果访问量不大，对数据库的 CRUD 操作就不多，每次访问都创建连接并在使用完销毁连接就没什么，但是如果访问量比较多，并发的要求比较高时，频繁创建和销毁连接就比较消耗资源了。</p> <p>这时，可以不销毁连接，一直使用已创建的连接，就可以避免频繁创建销毁连接的损耗了。但是有个问题，一个连接同一时间只能做一件事，某使用者（一般是线程）正在使用时，其他使用者就不可以使用了，所以如果只创建一个不关闭的连接显然不符合要求，我们需要创建多个不关闭的连接。</p> <p>这就是<strong>连接池</strong>的来源，创建多个数据库连接，当有调用的时候直接在创建好的连接中拿出来使用，使用完毕之后将连接放回去供其他调用者使用。</p> <p>我们以 Node.js 中 <code>mysql</code> 模块的连接池应用为例，看看后端一般是如何使用数据库连接池的。在 Node.js 中使用 <code>mysql</code> 创建单个连接，一般这样使用：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> connection <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span>     <span class="token comment">// 创建数据库连接</span>
  <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>         <span class="token comment">// 用户名</span>
  <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'123456'</span><span class="token punctuation">,</span>   <span class="token comment">// 密码</span>
  <span class="token literal-property property">database</span><span class="token operator">:</span> <span class="token string">'db'</span><span class="token punctuation">,</span>       <span class="token comment">// 指定数据库</span>
  <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token string">'3306'</span>          <span class="token comment">// 端口号</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 连接回调，在回调中增删改查</span>
connection<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>

<span class="token comment">// 关闭连接</span>
connection<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>在 Node.js 中使用 <code>mysql</code> 模块的连接池创建连接：</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> mysql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> pool <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createPool</span><span class="token punctuation">(</span><span class="token punctuation">{</span>     <span class="token comment">// 创建数据库连接池</span>
  <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>         <span class="token comment">// 用户名</span>
  <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'123456'</span><span class="token punctuation">,</span>   <span class="token comment">// 密码</span>
  <span class="token literal-property property">database</span><span class="token operator">:</span> <span class="token string">'db'</span><span class="token punctuation">,</span>       <span class="token comment">// 制定数据库</span>
  <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token string">'3306'</span>          <span class="token comment">// 端口号</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 从连接池中获取一个连接，进行增删改查</span>
pool<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> connection</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ... 数据库操作</span>
  connection<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 将连接释放回连接池中</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 关闭连接池</span>
pool<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>一般连接池在初始化的时候，都会自动打开 n 个连接，称为<strong>连接预热</strong>。如果这 n 个连接都被使用了，再从连接池中请求新的连接时，会动态地隐式创建额外连接，即<strong>自动扩容</strong>。如果扩容后的连接池一段时间后有不少连接没有被调用，则<strong>自动缩容</strong>，适当释放空闲连接，增加连接池中连接的使用效率。在连接失效的时候，自动<strong>抛弃无效连接</strong>。在系统关闭的时候，自动<strong>释放所有连接</strong>。为了维持连接池的有效运转和避免连接池无限扩容，还会给连接池设置最大最小连接数。</p> <p>这些都是连接池的功能，可以看到连接池一般可以根据当前使用情况自动地进行缩容和扩容，来进行连接池资源的最优化，和连接池连接的复用效率最大化。这些连接池的功能点，看着是不是和之前驾考例子的优化过程有点似曾相识呢！</p> <p>在实际项目中，除了数据库连接池外，还有 <strong>HTTP 连接池</strong>。使用 HTTP 连接池管理长连接可以复用 HTTP 连接，省去创建 TCP 连接的 3 次握手和关闭 TCP 连接的 4 次挥手的步骤，降低请求响应的时间。</p> <p>连接池某种程度也算是一种缓冲池，只不过这种缓冲池是专门用来管理连接的。</p> <h3 id="字符常量池"><a href="#字符常量池" class="header-anchor">#</a> 字符常量池</h3> <p>很多语言的引擎为了减少字符串对象的重复创建，会在内存中维护有一个特殊的内存，这个内存就叫<strong>字符常量池</strong>。当创建新的字符串时，引擎会对这个字符串进行检查，与字符常量池中已有的字符串进行比对，如果存在有相同内容的字符串，就直接将引用返回，否则在字符常量池中创建新的字符常量，并返回引用。</p> <p>类似于 Java、C# 这些语言，都有字符常量池的机制。JavaScript 有多个引擎，以 Chrome 的 V8 引擎为例，V8 在把 JavaScript 编译成字节码过程中就引入了字符常量池这个优化手段，这就是为什么很多 JavaScript 的书籍都提到了 JavaScript 中的字符串具有不可变性，因为如果内存中的字符串可变，一个引用操作改变了字符串的值，那么其他同样的字符串也会受到影响。</p> <p>V8 引擎中的字符常量池存在一个变量 <code>string_table_</code> 中，这个变量保存有所有的字符串 <code>All strings are copied here, one after another</code>，地址位于 <a href="https://github.com/v8/v8/blob/7.7.205/src/ast/ast-value-factory.h#L349-L350" target="_blank" rel="noopener noreferrer">v8/src/ast/ast-value-factory.h<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，核心方法是 <a href="https://github.com/v8/v8/blob/7.7.205/src/ast/ast-value-factory.cc#L275" target="_blank" rel="noopener noreferrer">LookupOrInsert<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，这个方法给每一个字符串计算出 hash 值，并从 table 中搜索，没有则插入，感兴趣的话可以自行阅读。</p> <p>引用《JavaScript 高级程序设计》中的话解释一下：</p> <blockquote><p>ECMAScript 中的字符串是不可变的，也就是说，字符串一旦创建，它们的值就不能改变。要改变某个变量保存的字符串，首先要销毁原来的字符串，然后再用另一个包含新值的字符串填充该变量。</p></blockquote> <p>字符常量池也是复用资源的一种手段，只不过这种手段通常用在编译器的运行过程中，通常开发（搬砖）过程用不到，了解即可。</p> <h2 id="设计原则验证"><a href="#设计原则验证" class="header-anchor">#</a> 设计原则验证</h2> <ul><li>将相同的部分抽象出来</li> <li>符合开放封闭原则</li></ul> <h2 id="享元模式的优缺点"><a href="#享元模式的优缺点" class="header-anchor">#</a> 享元模式的优缺点</h2> <p>优点：</p> <ul><li>由于<strong>减少了系统中的对象数量</strong>，提高了程序运行效率和性能，精简了内存占用，加快运行速度。</li> <li><strong>外部状态相对独立</strong>，不会影响到内部状态，所以享元对象能够在不同的环境被共享。</li></ul> <p>缺点：</p> <ul><li>引入了共享对象，使对象结构变得复杂。</li> <li>共享对象的创建、销毁等需要维护，带来额外的复杂度（如果需要把共享对象维护起来的话）。</li></ul> <h2 id="享元模式的适用场景"><a href="#享元模式的适用场景" class="header-anchor">#</a> 享元模式的适用场景</h2> <ul><li>如果一个程序中大量使用了相同或相似对象，那么可以考虑引入享元模式。</li> <li>如果使用了大量相同或相似对象，并造成了比较大的内存开销。</li> <li>对象的大多数状态可以被转变为外部状态。</li> <li>剥离出对象的外部状态后，可以使用相对较少的共享对象取代大量对象。</li></ul> <p>在一些程序中，如果引入享元模式对系统的性能和内存的占用影响不大时，比如目标对象不多，或者场景比较简单，则不需要引入，以免适得其反。</p> <h2 id="其他相关模式"><a href="#其他相关模式" class="header-anchor">#</a> 其他相关模式</h2> <p>享元模式和单例模式、工厂模式、组合模式、策略模式、状态模式等等可以一起使用。</p> <h3 id="享元模式和工厂模式、单例模式"><a href="#享元模式和工厂模式、单例模式" class="header-anchor">#</a> 享元模式和工厂模式、单例模式</h3> <p>在区分出不同种类的外部状态后，创建新对象时需要选择不同种类的共享对象，这时就可以使用工厂模式来提供共享对象，在共享对象的维护上，经常会采用单例模式来提供单实例的共享对象。</p> <h3 id="享元模式和组合模式"><a href="#享元模式和组合模式" class="header-anchor">#</a> 享元模式和组合模式</h3> <p>在使用工厂模式来提供共享对象时，比如某些时候共享对象中的某些状态就是对象不需要的，可以引入组合模式来提升自定义共享对象的自由度，对共享对象的组成部分进一步归类、分层，来实现更复杂的多层次对象结构，当然系统也会更难维护。</p> <h3 id="享元模式和策略模式"><a href="#享元模式和策略模式" class="header-anchor">#</a> 享元模式和策略模式</h3> <p>策略模式中的策略属于一系列功能单一、细粒度的细粒度对象，可以作为目标对象来考虑引入享元模式进行优化，但是前提是这些策略是会被频繁使用的，如果不经常使用，就没有必要了。</p> <p>（完）</p></div> <!----> <div class="content__content-bottom"></div> <footer class="page-meta"><div class="edit-link"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon edit-icon"><path d="M117.953 696.992 64.306 959.696l265.931-49.336 450.204-452.505-212.284-213.376-450.204 452.513zm496.384-296.326L219.039 797.993l-46.108-46.34L568.233 354.33l46.104 46.335zm345.357-122.99-114.45 115.04-212.288-213.377 114.45-115.035 212.288 213.371zm0 0" fill="currentColor"></path></svg> <a href="https://github.com/wenyuan/fedbook/edit/main/docs/in-depth-learning/design-patterns/flyweight-pattern.md" target="_blank" rel="noopener noreferrer">编辑此页</a></div> <div class="meta-item update-time"><span class="label">上次编辑于:</span> <span class="info">2022年3月30日 10:59</span></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/in-depth-learning/design-patterns/composite-pattern/" class="prev"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon prev-icon"><path d="M906.783 588.79c-.02 8.499-6.882 15.36-15.38 15.37l-443.7-.01 75.704 191.682c2.52 6.42.482 13.763-5.038 17.91-5.52 4.168-13.138 4.147-18.616-.092L123.228 524.175a15.362 15.362 0 0 1-6-12.165c0-4.782 2.222-9.277 6-12.185L499.753 210.35a15.388 15.388 0 0 1 9.38-3.195c3.236 0 6.502 1.034 9.236 3.103 5.52 4.147 7.578 11.49 5.038 17.91L447.683 419.84l443.72-.01c8.498.01 15.36 6.881 15.36 15.36l.02 153.6z" fill="currentColor"></path></svg>
        组合模式(前端不常用)
      </a></span> <span class="next"><a href="/in-depth-learning/design-patterns/observer-pattern/">
        观察者模式
        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon next-icon"><path d="M906.772 512c0 4.772-2.211 9.267-5.99 12.175L524.257 813.66a15.37 15.37 0 0 1-18.616.092 15.368 15.368 0 0 1-5.038-17.91l75.714-191.672h-443.73c-8.488 0-15.36-6.881-15.36-15.36v-153.6c0-8.489 6.872-15.36 15.36-15.36h443.73l-75.714-191.682a15.358 15.358 0 0 1 5.048-17.91c5.51-4.158 13.128-4.137 18.606.092l376.525 289.485a15.323 15.323 0 0 1 5.99 12.165z" fill="currentColor"></path></svg></a></span></p></div> <!----> <!----> <div class="content__page-bottom"></div></main> <!----></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.34fc3e13.js" defer></script><script src="/assets/js/vendors~layout-Layout.a3786f42.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.a77e3a6c.js" defer></script><script src="/assets/js/page-享元模式.b25964f3.js" defer></script>
  </body>
</html>
